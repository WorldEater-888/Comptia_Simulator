<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SYSTEM_ROOT_V20_FINAL</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* GLOBAL VARS */
            --term-color: #0affba; 
            --term-dim: rgba(10, 255, 186, 0.4); 
            --split-1: #ff0000; 
            --split-2: #00ffff;
            --glow-color: rgba(10, 255, 186, 0.5);
            --hint-color: #ffd700;
            
            --edge-opacity: 0;
            --shake-amp: 0px; 
            --glitch-amp: 1px;
            --sway-speed: 5s; 
        }

        html, body, * { cursor: none !important; }

        #custom-cursor {
            position: fixed; top: 0; left: 0; width: 15px; height: 15px;
            border: 2px solid var(--term-color); 
            background-color: rgba(10, 255, 186, 0.05);
            box-shadow: 0 0 11px var(--term-color), inset 0 0 9px var(--term-color);
            animation: cursor-flicker 0.05s infinite;
            z-index: 9999; pointer-events: none;
            transform: translate(-50%, -50%);
            transition: width 0.1s, height 0.1s; mix-blend-mode: screen;
        }
        @keyframes cursor-flicker {
            0% { opacity: 1; transform: translate(-50%, -50%) skewX(0deg); }
            50% { opacity: 0.8; transform: translate(-50%, -50%) skewX(-10deg); }
            100% { opacity: 1; transform: translate(-50%, -50%) skewX(0deg); }
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        ::-webkit-scrollbar { width: 8px; background: #000; }
        ::-webkit-scrollbar-thumb { background: var(--term-color); border: 1px solid #000; box-shadow: 0 0 5px var(--term-color); }
        ::-webkit-scrollbar-track { background: rgba(0, 20, 20, 0.5); border-left: 1px solid var(--term-color); }

        body {
            background-color: #000000; margin: 0; padding: 40px 20px 20px 20px; 
            font-family: 'VT323', monospace; color: var(--term-color);
            overflow: hidden; height: 100vh;
            display: flex; justify-content: center; align-items: center;
            text-shadow: 0 0 5px var(--glow-color); 
            box-shadow: inset 0 0 80px var(--glow-color);
            animation: ghost-sway var(--sway-speed) ease-in-out infinite alternate;
            transition: color 0.4s ease, text-shadow 0.4s ease; 
        }

        .scan-line { position: fixed; left: 0; width: 100%; background: var(--term-color); opacity: 0.25; z-index: 600; pointer-events: none; box-shadow: 0 0 11px var(--term-color); }
        @keyframes scan-drop { 0% { top: -10%; opacity: 0; } 10% { opacity: 0.35; } 100% { top: 110%; opacity: 0; } }

        .pixel-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 900; background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px); }
        #matrix-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; opacity: 0.25; }
        .retro-grid {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 45vh; z-index: -3;
            background: linear-gradient(transparent 0%, rgba(0, 255, 128, 0.1) 2%, transparent 3%), linear-gradient(90deg, transparent 0%, rgba(0, 255, 128, 0.1) 2%, transparent 3%);
            background-size: 50px 50px; transform: perspective(600px) rotateX(70deg) scale(2);
            opacity: 0.5; animation: grid-move 10s linear infinite;
        }
        #panic-pulse {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 850;
            box-shadow: inset 0 0 150px #ff0000; opacity: var(--edge-opacity); mix-blend-mode: overlay;
            animation: pulse-breath-erratic 4s infinite; 
        }

        .terminal-window {
            width: 100%; max-width: 1000px; height: 100%; max-height: 95vh;
            border: 2px solid var(--term-color); 
            background: rgba(0, 5, 5, 0.75); backdrop-filter: blur(8px); 
            padding: 20px;
            display: none; flex-direction: column; position: relative;
            box-shadow: 5px 5px 0px rgba(0, 20, 20, 0.5), inset 0 0 20px rgba(0,0,0,0.5);
            z-index: 100; overflow: hidden; margin-top: 10px;
            transition: border-color 0.2s ease, filter 0.2s ease; 
        }
        .power-on { display: flex !important; animation: turnOn 0.8s cubic-bezier(0.23, 1, 0.32, 1) forwards; }

        .header { 
            border-bottom: 4px solid var(--term-color); padding-bottom: 10px; margin-bottom: 15px; 
            display: flex; flex-direction: column; gap: 5px; flex-shrink: 0; position: relative;
        }
        .header-top { display: flex; justify-content: space-between; align-items: flex-start; width: 100%; }
        
        .h-left h1 { 
            margin: 0; font-size: 3.5rem; letter-spacing: 4px; line-height: 1;
            text-shadow: 4px 0 var(--split-1), -4px 0 var(--split-2);
            display: inline-block; font-weight: normal;
        }

        /* --- DASHBOARD (New Layout + Old FX) --- */
        .sys-dashboard {
            display: grid; grid-template-columns: 2fr 1fr 2fr; /* Integrity | Stats | Temp */
            gap: 20px; align-items: end; margin-top: 5px;
            padding: 8px; border: 1px dashed var(--term-dim); background: rgba(0,0,0,0.2);
        }
        .dash-module { display: flex; flex-direction: column; gap: 4px; }
        .dash-label { font-size: 0.9rem; letter-spacing: 2px; font-weight: bold; text-transform: uppercase; display: flex; justify-content: space-between; }
        
        /* GAUGE CONTAINER */
        .gauge-container {
            width: 100%; height: 30px;
            border: 2px solid var(--term-color); background: #000;
            position: relative; padding: 2px;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.5);
            transition: border-color 0.2s;
        }
        /* RULER LINES */
        .gauge-container::after {
            content: " "; position: absolute; top:0; left:0; width: 100%; height: 100%; pointer-events: none;
            background: repeating-linear-gradient(90deg, transparent, transparent 19px, rgba(255,255,255,0.1) 20px); z-index: 5;
        }

        /* INTEGRITY BAR (RESTORED FX) */
        .integrity-fill {
            height: 100%; width: 100%;
            /* STRIPES RESTORED */
            background: repeating-linear-gradient(90deg, var(--term-color), var(--term-color) 8px, transparent 8px, transparent 10px);
            box-shadow: 0 0 15px var(--term-color); position: relative; z-index: 2;
            transition: width 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            animation: health-pulse 1s infinite alternate;
        }
        
        /* DAMAGE FX RESTORED */
        .integrity-critical .integrity-fill {
             animation: crit-pulse 0.2s infinite !important;
             background: repeating-linear-gradient(90deg, #ff0000, #ff0000 8px, transparent 8px, transparent 10px) !important;
             box-shadow: 0 0 25px #ff0000 !important;
        }
        .integrity-critical { border-color: #ff0000; }

        .dmg-shock { animation: damage-flash 0.4s cubic-bezier(0.1, 0.7, 1.0, 0.1); }
        @keyframes damage-flash { 0% { transform: scale(1); filter: brightness(1); } 50% { transform: scale(1.05); filter: brightness(5) hue-rotate(180deg); } 100% { transform: scale(1); filter: brightness(1); } }
        @keyframes health-pulse { 0% { opacity: 1; filter: brightness(1); } 100% { opacity: 0.8; filter: brightness(1.2); } }
        @keyframes crit-pulse { 0% { filter: brightness(1); opacity: 1; box-shadow: 0 0 25px #ff0000; } 50% { filter: brightness(5); opacity: 0.8; box-shadow: 0 0 50px #ff0000; } 100% { filter: brightness(1); opacity: 1; box-shadow: 0 0 25px #ff0000; } }

        /* TEMP BAR */
        #temp-bar { 
            width: 0%; height: 100%; background: var(--term-color);
            transition: width 1s linear; /* Smooth creep */ 
        }

        /* STROBE FX */
        @keyframes temp-strobe {
            0% { background-color: #ff0000; box-shadow: 0 0 20px #ff0000; }
            50% { background-color: #ffffff; box-shadow: 0 0 40px #ffffff; }
            100% { background-color: #ff0000; box-shadow: 0 0 20px #ff0000; }
        }
        .strobe-active { animation: temp-strobe 0.15s infinite !important; }

        /* --- BUTTONS --- */
        .donate-group { display: flex; gap: 6px; }
        .sys-btn {
            background: rgba(0, 0, 0, 0.8);
            font-family: 'VT323', monospace; font-size: 1.0rem; font-weight: bold;
            cursor: pointer; padding: 4px 12px; border: 1px solid;
            box-shadow: 2px 2px 0px rgba(0,0,0,0.5); transition: all 0.2s ease;
            text-transform: uppercase;
        }
        .sys-btn:hover { transform: translate(-1px, -1px); box-shadow: 4px 4px 0px rgba(0,0,0,0.8); z-index: 1001; opacity: 1; }
        
        .kofi-btn { color: #ffd700; border-color: #ffd700; }
        .kofi-btn:hover { background: #ffd700; color: #000; box-shadow: 0 0 15px #ffd700; }
        .bmc-btn { color: #FF813F; border-color: #FF813F; }
        .bmc-btn:hover { background: #FF813F; color: #000; box-shadow: 0 0 15px #FF813F; }
        .kas-btn { color: #70c7ba; border-color: #70c7ba; }
        .kas-btn:hover { background: #70c7ba; color: #000; box-shadow: 0 0 15px #70c7ba; }

        .ctrl-cluster { 
            text-align: center; display: flex; flex-direction: column; justify-content: flex-end; height: 100%; 
            border-left: 1px solid var(--term-dim); border-right: 1px solid var(--term-dim);
        }
        .score-display { font-size: 1.8rem; font-weight: bold; line-height: 1; margin-bottom: 2px; }

        /* --- MENU & LAYOUT --- */
        .menu-grid { display: grid; grid-template-columns: 1fr; gap: 8px; margin-top: 5px; overflow-y: auto; padding-right: 5px; padding-bottom: 20px; }
        .btn { 
            background: rgba(0,0,0,0.5); border: 2px solid var(--term-color); color: var(--term-color); 
            font-family: 'VT323', monospace; font-size: 1.35rem; padding: 10px 15px;
            cursor: pointer; text-align: left; transition: 0.1s; position: relative;
            overflow: hidden; opacity: 0; transform: translateY(10px);
            box-shadow: 5px 5px 0px rgba(0,0,0,0.5);
        }
        .btn.drift-active { animation: random-drift 6s ease-in-out infinite alternate; }
        .btn.visible { opacity: 1 !important; transform: translateY(0) !important; transition: opacity 0.5s ease, transform 0.5s ease; }
        .btn:hover { background: #fff; color: #000; box-shadow: 0 0 30px #fff; border-color: #fff; transform: translate(-2px, -2px) !important; }
        .btn.exam-mode { border-color: #ff4444; color: #ff4444; }
        .btn.exam-mode:hover { background: #ff4444; color: white; box-shadow: 0 0 60px #ff4444; }

        .quiz-container { display: flex; flex-direction: column; flex-grow: 1; overflow-y: auto; overflow-x: hidden; padding-right: 10px; }
        .quiz-header-bar {
            display:flex; justify-content:space-between; align-items:center; 
            border-bottom: 1px solid var(--term-color); padding-bottom: 10px; margin-bottom: 20px; font-size: 1.3rem; flex-shrink: 0;
        }

        /* === RESTORED ORIGINAL QUESTION UI === */
        .question-box { 
            font-size: 1.8rem; line-height: 1.3; margin-bottom: 20px; min-height: 80px; 
            background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent);
            border-left: 8px solid var(--term-color); padding-left: 20px; color: #ffffff !important;
            text-shadow: 0 0 5px rgba(255,255,255,0.3); animation: random-drift 7s ease-in-out infinite alternate;
            box-shadow: 3px 3px 0px rgba(0,0,0,0.3);
        }
        
        .options-list { display: flex; flex-direction: column; gap: 15px; }

        .option-btn { 
            background: rgba(0, 0, 0, 0.7); border: 2px solid var(--term-color); 
            color: #ffffff !important; padding: 15px; font-family: 'VT323', monospace; font-size: 1.5rem; text-align: left; 
            cursor: pointer; transition: 0.1s; position: relative; overflow: hidden;
            text-shadow: 0 0 2px rgba(255,255,255,0.5); backdrop-filter: blur(8px); 
            box-shadow: 5px 5px 0px rgba(0,0,0,0.5);
        }
        .option-btn:hover { background: #fff !important; color: #000 !important; border-color: #fff; box-shadow: 0 0 40px #fff; transform: translate(-2px, -2px); }
        .option-btn.correct { background: var(--term-color) !important; color: black !important; border-color: white; box-shadow: 0 0 80px var(--term-color) !important; }
        .option-btn.wrong { background: #a00 !important; color: white !important; border-color: red; box-shadow: 0 0 80px red !important; animation: answer-shake 0.4s; }

        .abort-btn { cursor:pointer; text-decoration:underline; font-weight: bold; color: #fff; transition: 0.2s; }
        .abort-btn:hover { color: #ff0000; text-shadow: 0 0 15px #ff0000; }

        .hacker-footer {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 25px;
            background: rgba(0, 0, 0, 0.0); backdrop-filter: blur(2px);
            z-index: 1000; display: flex; align-items: center; box-shadow: 0 -2px 10px rgba(0,0,0,0.5);
        }
        .ticker-content { white-space: nowrap; font-size: 0.8rem; color: var(--term-dim); animation: ticker-scroll 360s linear infinite; padding-left: 100%; }
        @keyframes ticker-scroll { 100% { transform: translateX(-100%); } }

        /* ANIMATIONS */
        @keyframes turnOn { 0% { transform: scaleY(0.005) scaleX(0); opacity: 0; filter: brightness(4); } 60% { transform: scaleY(0.005) scaleX(1); opacity: 1; filter: brightness(2); } 100% { transform: scaleY(1) scaleX(1); opacity: 1; filter: brightness(1); } }
        @keyframes random-drift { 0% { transform: translate(0, 0); } 100% { transform: translate(2px, 1px); } }
        @keyframes answer-shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
        @keyframes pulse-breath-erratic { 0% { opacity: var(--edge-opacity); } 50% { opacity: calc(var(--edge-opacity) * 0.4); } 100% { opacity: var(--edge-opacity); } }
        @keyframes label-flash { 0%, 100% { color: #ff0000; text-shadow: 0 0 5px #ff0000; } 50% { color: #fff; text-shadow: 0 0 2px #fff; } }
        .label-crit { animation: label-flash 0.3s infinite; }
        .logo-glitch { animation: slice-glitch 0.3s both infinite; }
        @keyframes slice-glitch { 0% { clip-path: inset(0 0 0 0); transform: translate(0); } 10% { clip-path: inset(10% 0 85% 0); transform: translate(-5px, 2px); } 50% { clip-path: inset(0 0 0 0); transform: translate(0); } 100% { clip-path: inset(0 0 0 0); transform: translate(0); } }
        
        .hex-dump { position: absolute; font-family: monospace; font-size: 14px; color: var(--term-color); opacity: 0.4; z-index: -1; white-space: pre; pointer-events: none; text-shadow: 0 0 2px var(--glow-color); }
        .float-text { position: absolute; font-weight: bold; font-size: 2rem; pointer-events: none; animation: floatUp 2s forwards; z-index: 2000; }
        @keyframes floatUp { 100% { opacity: 0; transform: translateY(-50px) scale(1.2); } }
        .hidden { display: none !important; }
        #start-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: #000; z-index: 2000; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; }
    </style>
</head>
<body class="glitch-active">

<div id="custom-cursor"></div>
<div class="pixel-overlay"></div>
<canvas id="matrix-canvas"></canvas>
<div class="retro-grid"></div>
<div id="panic-pulse"></div> 
<div id="scan-container"></div> 

<div id="start-overlay" onclick="bootSystem()">
    <div style="font-size: 4rem; color: #fff; letter-spacing: 8px; text-shadow: 4px 0 var(--split-1), -4px 0 var(--split-2); margin-bottom: 40px;" class="logo-glitch">[ SYSTEM_ROOT ]</div>
    <div style="font-size: 1.5rem; color: var(--term-color); animation: label-flash 2s infinite;">>> INITIALIZE_DESKTOP_ENVIRONMENT <<</div>
</div>

<div class="terminal-window" id="term-win">
    
    <div class="header">
        <div class="header-top">
            <div class="h-left">
                <h1 id="main-header">SYSTEM <span style="font-size: 0.6em; color:#fff;">ROOT</span></h1>
                <div style="display:flex; gap: 20px; font-size:1.1rem; opacity:0.8; margin-top:5px;">
                    <div id="status-text-1">> STATUS: WAITING...</div>
                    <div id="status-text-2">> NET: IDLE</div>
                </div>
            </div>
            
            <div class="donate-group">
                <button class="sys-btn kofi-btn" onclick="AudioEngine.playMenuHover(); window.open('https://ko-fi.com/worldeater888', '_blank')">[ SUPPORT ]</button>
                <button class="sys-btn bmc-btn" onclick="AudioEngine.playMenuHover(); window.open('https://buymeacoffee.com', '_blank')">[ COFFEE ]</button>
                <button class="sys-btn kas-btn" onclick="AudioEngine.playMenuHover(); showCrypto()">[ KASPA ]</button>
            </div>
        </div>
        
        <div class="sys-dashboard">
            <div class="dash-module">
                <div class="dash-label">
                    <span>CORE_INTEGRITY</span>
                    <span id="integrity-pct">100%</span>
                </div>
                <div class="gauge-container" id="integrity-cont">
                    <div class="integrity-fill" id="integrity-bar" style="width: 100%;"></div>
                </div>
            </div>

            <div class="dash-module ctrl-cluster">
                <div class="score-display" id="score-ui">PTS: 0</div>
                <button id="sound-toggle" class="sys-btn" style="font-size:0.8rem; padding: 2px;" onclick="AudioEngine.toggleMute()">[ AUDIO: ON ]</button>
            </div>

            <div class="dash-module">
                <div class="dash-label">
                    <span id="temp-label">SYS_TEMP</span>
                    <span id="temp-val">0°C</span>
                </div>
                <div class="gauge-container" style="border-color: #fff;">
                    <div class="gauge-fill" id="temp-bar" style="background:var(--term-color);"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="root-menu">
        <p style="font-size: 1.2rem; border-bottom: 1px dashed var(--term-color); padding-bottom: 9px;">> SELECT_CERTIFICATION:</p>
        <div class="menu-grid">
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="goToSubMenu('core1')">[1] COMPTIA A+ CORE 1 <span style="float:right">>></span></button>
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="goToSubMenu('core2')">[2] COMPTIA A+ CORE 2 <span style="float:right">>></span></button>
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="goToSubMenu('net')">[3] NETWORK+ <span style="float:right">>></span></button>
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="goToSubMenu('sec')">[4] SECURITY+ <span style="float:right">>></span></button>
        </div>
    </div>

    <div id="core1-menu" class="hidden">
        <p style="font-size: 1.2rem; border-bottom: 1px dashed var(--term-color);">> CORE_1 // MODULES:</p>
        <div class="menu-grid">
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="transitionToQuiz('CORE1', 'Mobile')">[A] MOBILE_DEVICES</button>
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="transitionToQuiz('CORE1', 'Networking')">[B] NETWORKING</button>
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="transitionToQuiz('CORE1', 'Hardware')">[C] HARDWARE</button>
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="transitionToQuiz('CORE1', 'Cloud')">[D] VIRTUALIZATION</button>
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="transitionToQuiz('CORE1', 'Troubleshoot')">[E] TROUBLESHOOTING</button>
            <button class="btn exam-mode" onmouseenter="AudioEngine.playMenuHover()" onclick="startExam('CORE1')">[X] EXAM_SIMULATION</button>
            <button class="btn" style="border-color: #666; color: #888;" onmouseenter="AudioEngine.playMenuHover()" onclick="goToRoot()"> < BACK TO ROOT </button>
        </div>
    </div>
    
    <div id="core2-menu" class="hidden">
        <div class="menu-grid">
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="transitionToQuiz('CORE2', 'OS')">[A] OS_CONCEPTS</button>
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="transitionToQuiz('CORE2', 'Security')">[B] SECURITY</button>
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="transitionToQuiz('CORE2', 'Software')">[C] SOFTWARE_TRBL</button>
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="transitionToQuiz('CORE2', 'Ops')">[D] OPS_PROCEDURES</button>
            <button class="btn exam-mode" onmouseenter="AudioEngine.playMenuHover()" onclick="startExam('CORE2')">[X] EXAM_SIMULATION</button>
            <button class="btn" style="border-color: #666; color: #888;" onmouseenter="AudioEngine.playMenuHover()" onclick="goToRoot()"> < BACK TO ROOT </button>
        </div>
    </div>

    <div id="net-menu" class="hidden">
        <div class="menu-grid">
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="transitionToQuiz('NET', 'Fundamentals')">[A] FUNDAMENTALS</button>
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="transitionToQuiz('NET', 'Implement')">[B] IMPLEMENTATION</button>
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="transitionToQuiz('NET', 'Ops')">[C] OPERATIONS</button>
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="transitionToQuiz('NET', 'Security')">[D] SECURITY</button>
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="transitionToQuiz('NET', 'Troubleshoot')">[E] TROUBLESHOOTING</button>
            <button class="btn exam-mode" onmouseenter="AudioEngine.playMenuHover()" onclick="startExam('NET')">[X] EXAM_SIMULATION</button>
            <button class="btn" style="border-color: #666; color: #888;" onmouseenter="AudioEngine.playMenuHover()" onclick="goToRoot()"> < BACK TO ROOT </button>
        </div>
    </div>

    <div id="sec-menu" class="hidden">
        <div class="menu-grid">
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="transitionToQuiz('SEC', 'Concepts')">[A] GEN_CONCEPTS</button>
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="transitionToQuiz('SEC', 'Threats')">[B] THREATS_VULNS</button>
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="transitionToQuiz('SEC', 'Arch')">[C] ARCHITECTURE</button>
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="transitionToQuiz('SEC', 'Ops')">[D] SECURITY_OPS</button>
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="transitionToQuiz('SEC', 'Mgmt')">[E] MGMT_GOVERNANCE</button>
            <button class="btn exam-mode" onmouseenter="AudioEngine.playMenuHover()" onclick="startExam('SEC')">[X] EXAM_SIMULATION</button>
            <button class="btn" style="border-color: #666; color: #888;" onmouseenter="AudioEngine.playMenuHover()" onclick="goToRoot()"> < BACK TO ROOT </button>
        </div>
    </div>

    <div id="quiz-ui" class="hidden quiz-container">
        <div class="quiz-header-bar">
            <div style="display:flex; gap: 20px;">
                <span onclick="shutdownSystem()" onmouseenter="AudioEngine.playOptionHover()" class="abort-btn">< ABORT</span>
                <span style="color:var(--term-color);">[COUNTDOWN]: <span id="session-timer" style="color:#fff; font-weight:bold;">90:00</span></span>
                <span style="color:var(--term-color);">[PKT]: <span id="packet-counter" style="color:#fff; font-weight:bold;">00</span></span>
            </div>
            <span id="streak-text" style="font-weight: bold;">CONNECTIONS: 0</span>
        </div>
        
        <div class="question-box"><span id="q-text"></span></div>
        <div id="explanation-box" style="margin-bottom:20px; padding:15px; border:2px dashed #0affba; display:none; font-size:1.6rem; color:#fff;"></div>
        <div class="options-list" id="opts-list"></div>
        <div id="pbq-area" style="display:none; flex-direction:column; gap:20px; width:100%;"></div>
        <button id="pbq-submit-btn" onclick="submitPBQ()" class="sys-btn" style="width:100%; font-size:1.5rem; margin-top:20px; display:none;">[ EXECUTE_COMMAND ]</button>
        <button class="btn nav-btn hidden" id="next-btn" onmouseenter="AudioEngine.playMenuHover()" onclick="nextSeq()" style="margin-bottom: 10px; margin-top: 20px;">>> NEXT_PACKET >> </button>
    </div>

    <div id="results-ui" class="hidden" style="text-align: center; padding-top: 10px;">
        <h1 style="font-size: 5rem; margin-bottom: 0px;" id="final-percent">0%</h1>
        <p style="font-size: 2rem; margin-bottom: 10px;">> DIAGNOSTIC COMPLETE</p>
        <div id="breakdown-container" style="text-align:left; margin:20px auto; max-width:700px;"></div>
        <button class="btn" style="margin-top: 40px;" onmouseenter="AudioEngine.playMenuHover()" onclick="location.reload()">>> REBOOT_SYSTEM</button>
    </div>

    <div id="fail-ui" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(5,0,0,0.95); z-index:2000; flex-direction:column; justify-content:center; align-items:center;">
        <h1 class="logo-glitch" style="font-size: 8rem; color: #fff;">SYSTEM_CORRUPTED</h1>
        <button class="btn" style="background: red; color: white; border-color: red;" onmouseenter="AudioEngine.playMenuHover()" onclick="location.reload()">>> EMERGENCY RESTART</button>
    </div>
</div>

<div class="hacker-footer">
    <div class="ticker-content">
        >> SYS_LOG_START [0x1A4F] >> INITIATING_CORE_DUMP... COMPTIA_SIMULATOR_HYBRID_V20... LOADING_MODULES... ALL_SYSTEMS_NOMINAL... 
    </div>
</div>

<script>
    /* ============================ GLOBAL VARIABLES ============================ */
    const EXAM_WEIGHTS = {
        'CORE1': [{ tag: 'Mobile', pct: 0.14 }, { tag: 'Networking', pct: 0.20 }, { tag: 'Hardware', pct: 0.27 }, { tag: 'Cloud', pct: 0.11 }, { tag: 'Troubleshoot', pct: 0.28 }],
        'CORE2': [{ tag: 'OS', pct: 0.27 }, { tag: 'Security', pct: 0.24 }, { tag: 'Software', pct: 0.26 }, { tag: 'Ops', pct: 0.23 }],
        'NET': [{ tag: 'Fundamentals', pct: 0.23 }, { tag: 'Implement', pct: 0.18 }, { tag: 'Ops', pct: 0.16 }, { tag: 'Security', pct: 0.20 }, { tag: 'Troubleshoot', pct: 0.23 }],
        'SEC': [{ tag: 'Concepts', pct: 0.12 }, { tag: 'Threats', pct: 0.22 }, { tag: 'Arch', pct: 0.18 }, { tag: 'Ops', pct: 0.28 }, { tag: 'Mgmt', pct: 0.20 }]
    };

    let qQueue = []; let currentScore = 0; let integrity = 100; let tempLevel = 0; const TEMP_MAX = 60;
    let isDead = false; let isExam = false; let quizHistory = [];
    let hudInterval = null; let sessionTime = 5400; 
    let questionsAttempted = 0; let questionsCorrect = 0; let currentStreak = 0;

    /* ============================ AUDIO ENGINE (FIXED) ============================ */
    const AudioEngine = {
        ctx: null, masterGain: null, isMuted: false, delayNode: null, isPlaying: false,
        init: function() {
            try {
                const AC = window.AudioContext || window.webkitAudioContext;
                this.ctx = new AC();
                this.masterGain = this.ctx.createGain(); this.masterGain.gain.value = 0.3;
                this.masterGain.connect(this.ctx.destination);
                this.delayNode = this.ctx.createDelay(); this.delayNode.delayTime.value = 0.35;
                const fb = this.ctx.createGain(); fb.gain.value = 0.4;
                this.delayNode.connect(fb); fb.connect(this.delayNode); this.delayNode.connect(this.masterGain);
                if(this.ctx.state === 'suspended') this.ctx.resume();
                this.playBoot();
                this.startMusic(); // RESTORED
            } catch(e) {}
        },
        startMusic: function() { if(this.isPlaying) return; this.isPlaying = true; this.musicLoop(); },
        musicLoop: function() {
            if (!this.isPlaying || this.isMuted) return;
            const now = this.ctx.currentTime;
            const drone = this.ctx.createOscillator(); const droneGain = this.ctx.createGain();
            drone.type = 'sine'; drone.frequency.value = 55; 
            droneGain.gain.setValueAtTime(0.05, now); droneGain.gain.linearRampToValueAtTime(0, now + 6);
            drone.connect(droneGain); droneGain.connect(this.masterGain); drone.start(now); drone.stop(now + 6);
            const osc = this.ctx.createOscillator(); const g = this.ctx.createGain();
            osc.type = 'triangle'; const notes = [43.65, 55, 65.41, 73.42, 36.71]; 
            osc.frequency.value = notes[Math.floor(Math.random() * notes.length)];
            osc.detune.value = Math.random() * 20 - 10;
            g.gain.setValueAtTime(0, now); g.gain.linearRampToValueAtTime(0.2, now + 2); g.gain.linearRampToValueAtTime(0, now + 7); 
            osc.connect(g); g.connect(this.masterGain); g.connect(this.delayNode);
            osc.start(now); osc.stop(now + 7);
            setTimeout(() => this.musicLoop(), 4500); 
        },
        playSFX: function(type) {
            if(!this.ctx || this.isMuted) return;
            const t = this.ctx.currentTime;
            const osc = this.ctx.createOscillator(); const g = this.ctx.createGain();
            osc.connect(g); g.connect(this.masterGain);
            if(type === 'click') { osc.type='square'; osc.frequency.setValueAtTime(800, t); g.gain.setValueAtTime(0.01, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.05); osc.start(t); osc.stop(t+0.05); } 
            else if(type === 'success') { osc.type='sine'; osc.frequency.setValueAtTime(600, t); osc.frequency.exponentialRampToValueAtTime(1200, t+0.1); g.gain.setValueAtTime(0.1, t); g.gain.linearRampToValueAtTime(0, t+0.2); g.connect(this.delayNode); osc.start(t); osc.stop(t+0.2); } 
            else if(type === 'error') { osc.type='triangle'; osc.frequency.setValueAtTime(150, t); osc.frequency.linearRampToValueAtTime(50, t+0.4); g.gain.setValueAtTime(0.2, t); g.gain.linearRampToValueAtTime(0, t+0.4); osc.start(t); osc.stop(t+0.4); } 
        },
        playMenuHover: function() {
            if (!this.ctx || this.isMuted) return;
            const t = this.ctx.currentTime;
            const osc = this.ctx.createOscillator(); const g = this.ctx.createGain();
            osc.type = 'square'; osc.frequency.setValueAtTime(600 + Math.random() * 200, t); g.gain.setValueAtTime(0.02, t); g.gain.exponentialRampToValueAtTime(0.001, t + 0.1); 
            osc.connect(g); g.connect(this.masterGain); osc.start(t); osc.stop(t + 0.1);
        },
        playOptionHover: function() { this.playMenuHover(); },
        playBoot: function() {
            if (!this.ctx || this.isMuted) return;
            const t = this.ctx.currentTime;
            const osc = this.ctx.createOscillator(); const g = this.ctx.createGain();
            osc.type = 'sine'; osc.frequency.setValueAtTime(50, t); osc.frequency.exponentialRampToValueAtTime(600, t + 0.5);
            g.gain.setValueAtTime(0, t); g.gain.linearRampToValueAtTime(0.2, t + 0.1); g.gain.linearRampToValueAtTime(0, t + 0.5);
            osc.connect(g); g.connect(this.masterGain); osc.start(t); osc.stop(t + 0.5);
        },
        toggleMute: function() {
            this.isMuted = !this.isMuted;
            if(this.masterGain) this.masterGain.gain.setTargetAtTime(this.isMuted ? 0 : 0.3, this.ctx.currentTime, 0.1);
            document.getElementById('sound-toggle').innerText = this.isMuted ? "[ AUDIO: OFF ]" : "[ AUDIO: ON ]";
        }
    };

    /* ============================ VISUAL FX ============================ */
    function spawnScanline() {
        if(isDead) return;
        const line = document.createElement('div'); line.className = 'scan-line';
        line.style.height = (Math.random() * 3 + 1) + 'px';
        line.style.animation = `scan-drop ${Math.random() * 5 + 4}s linear forwards`;
        document.getElementById('scan-container').appendChild(line);
        setTimeout(() => line.remove(), 10000);
        setTimeout(spawnScanline, Math.random() * 8000 + 6000); 
    }
    spawnScanline();

    const techPhrases = ["> SPIRIT: AGGRIEVED", "> CANTICLE://SULPHURIC", "> SCRAPCODE://DETECTED", "> NOOSPHERE: DARKENED", "> VOID-LINK: ESTABLISHED", "> MACHINE_GOD://HEARS_YOU", "> SYSTEM: AWAKENING", "> CONSUME: PROCREATE", "> CHAOS: UNDIVIDED", "> CRUSH//MAIM//KILL", "> WAAAGH: ENERGY_SPIKE"];
    const techStatus = ["> PRAYER_LATENCY: 666ms", "> RITUAL_CYCLES: INFINITE", "> HOLY_INCENSE: IGNITED", "> DATA-GHOSTS: DETECTED", "> ENCRYPTION: CYTHRA-LOCK"];
    
    function cycleStatus() {
        if(isDead) return;
        scrambleText(document.getElementById('status-text-1'), techPhrases[Math.floor(Math.random() * techPhrases.length)], 500);
        setTimeout(() => { scrambleText(document.getElementById('status-text-2'), techStatus[Math.floor(Math.random() * techStatus.length)], 800); }, 1000 + Math.random() * 1000);
        setTimeout(cycleStatus, 5000 + Math.random() * 10000);
    }
    cycleStatus();

    function spawnHexDump() {
        if(isDead) return;
        const chars = "0123456789ABCDEF"; let str = "";
        for(let r=0; r<6; r++) { str += "0x"; for(let i=0; i<4; i++) str += chars[Math.floor(Math.random()*16)]; str += "\n"; }
        const el = document.createElement('div'); el.className = "hex-dump";
        el.style[Math.random() > 0.5 ? 'left' : 'right'] = Math.random() * 15 + "%";
        el.style.top = Math.random() * 90 + "%";
        document.body.appendChild(el);
        scrambleText(el, str, 1000);
        setTimeout(()=>el.remove(), 8000);
        setTimeout(spawnHexDump, Math.random() * 3000 + 2000);
    }

    function scrambleText(element, finalString, duration=500) {
        const alphabet = "0101010101XYZ<>";
        let start = Date.now();
        function update() {
            let prog = (Date.now() - start) / duration;
            if(prog >= 1) { element.innerText = finalString; return; }
            let txt = "";
            for(let i=0; i<finalString.length; i++) {
                if(i < finalString.length * prog) txt += finalString[i]; else txt += alphabet[Math.floor(Math.random()*alphabet.length)];
            }
            element.innerText = txt;
            requestAnimationFrame(update);
        }
        update();
    }

    const canvas = document.getElementById('matrix-canvas'); const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    const drops = Array(Math.floor(canvas.width / 14)).fill(1);
    function drawRain() {
        if(Math.random() > 0.5) { requestAnimationFrame(drawRain); return; }
        ctx.fillStyle = 'rgba(0, 0, 0, 0.05)'; ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#0affba'; ctx.font = '14px monospace';
        for(let i=0; i<drops.length; i++) {
            const char = String.fromCharCode(0x30A0 + Math.random() * 96);
            ctx.fillText(char, i*14, drops[i]*14);
            if(drops[i]*14 > canvas.height && Math.random() > 0.99) drops[i] = 0;
            drops[i]++;
        }
        requestAnimationFrame(drawRain);
    }
    drawRain();

    /* ============================ CURSOR LOGIC ============================ */
    const cursor = document.getElementById('custom-cursor');
    document.addEventListener('mousemove', (e) => {
        cursor.style.left = e.clientX + 'px'; cursor.style.top = e.clientY + 'px';
        if(Math.random() > 0.7) {
            const trail = document.createElement('div'); trail.className = 'cursor-trail';
            trail.style.position = 'fixed'; trail.style.left = e.clientX + 'px'; trail.style.top = e.clientY + 'px';
            trail.style.width = '10px'; trail.style.height = '10px'; trail.style.background = 'rgba(10,255,186,0.5)';
            trail.style.pointerEvents = 'none'; document.body.appendChild(trail);
            setTimeout(() => trail.remove(), 300);
        }
    });

    /* ============================ GAME LOGIC ============================ */
    function bootSystem() {
        document.getElementById('start-overlay').style.display = 'none';
        AudioEngine.init(); 
        document.getElementById('term-win').style.display = 'flex';
        document.getElementById('term-win').classList.add('power-on');
        spawnHexDump();
        const rootBtns = document.querySelectorAll('#root-menu .btn');
        rootBtns.forEach((b, i) => setTimeout(() => { b.classList.add('visible'); b.classList.add('drift-active'); }, 500 + i*150));
    }

    function shutdownSystem() {
        AudioEngine.playSFX('error'); 
        location.reload(); 
    }

    function startHUD() {
        if (hudInterval) clearInterval(hudInterval);
        document.getElementById('packet-counter').innerText = qQueue.length.toString().padStart(3, '0');
        
        hudInterval = setInterval(() => {
            if(isDead) return;
            if (sessionTime > 0) sessionTime--;
            let mins = Math.floor(sessionTime / 60); let secs = sessionTime % 60;
            document.getElementById('session-timer').innerText = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;

            if (document.getElementById('next-btn').classList.contains('hidden')) {
                if (tempLevel < TEMP_MAX) tempLevel++;
                updateTempVisuals();
            }
        }, 1000);
    }

    function updateTempVisuals() {
        const bar = document.getElementById('temp-bar');
        const label = document.getElementById('temp-label');
        const val = document.getElementById('temp-val');
        const pct = tempLevel / TEMP_MAX;
        
        bar.style.width = `${pct * 100}%`;
        val.innerText = `${tempLevel * 2}°C`; 
        
        bar.classList.remove('strobe-active');
        label.classList.remove('label-crit');

        if (tempLevel >= 50) {
            label.innerText = "!! CRITICAL !!"; label.style.color = "#ff0000"; 
            label.classList.add('label-crit'); bar.classList.add('strobe-active');
            bar.style.backgroundColor = '#ff0000';
        } else if (tempLevel >= 40) {
            label.innerText = ">> DANGER <<"; label.style.color = "orange";
            bar.style.backgroundColor = '#ff4400';
        } else if (tempLevel >= 20) {
            label.innerText = "WARMING..."; label.style.color = "yellow";
            bar.style.backgroundColor = '#ffff00';
        } else {
            label.innerText = "SYS_TEMP"; label.style.color = "#0affba";
            bar.style.backgroundColor = '#0affba';
        }
    }
    
    function resetTemp() { tempLevel = 0; updateTempVisuals(); }

    function updateIntegrity() {
        if (integrity > 100) integrity = 100; if (integrity < 0) integrity = 0;
        
        const bar = document.getElementById('integrity-bar');
        const txt = document.getElementById('integrity-pct');
        const cont = document.getElementById('integrity-cont');
        
        bar.style.width = `${integrity}%`;
        txt.innerText = `${integrity}%`;
        document.getElementById('score-ui').innerText = `PTS: ${currentScore}`;
        document.getElementById('streak-text').innerText = `CONNECTIONS: ${currentStreak}`;

        if(integrity < 30) { 
            cont.classList.add('integrity-critical'); 
            bar.style.backgroundColor = "red";
        } else {
            cont.classList.remove('integrity-critical');
            bar.style.backgroundColor = "#0affba";
        }
        if (integrity <= 0 && !isDead) {
             isDead = true; 
             document.getElementById('quiz-ui').classList.add('hidden');
             document.getElementById('fail-ui').classList.remove('hidden');
             AudioEngine.playSFX('error');
        }
    }

    function loadSeq() {
        if (integrity <= 0) return;
        resetTemp();
        document.getElementById('explanation-box').style.display = 'none';
        document.getElementById('opts-list').style.display = 'none';
        document.getElementById('pbq-area').style.display = 'none';
        document.getElementById('pbq-submit-btn').style.display = 'none';
        document.getElementById('next-btn').classList.add('hidden');

        if (qQueue.length === 0) { finish(); return; }
        
        window.currentQ = qQueue.pop();
        document.getElementById('packet-counter').innerText = qQueue.length.toString().padStart(3, '0');
        const qEl = document.getElementById('q-text'); 
        scrambleText(qEl, window.currentQ.question, 600);

        document.getElementById('opts-list').style.display = 'flex'; 
        renderMCQ(window.currentQ);
    }

    function renderMCQ(q) {
        const optsList = document.getElementById('opts-list'); optsList.innerHTML = '';
        q.options.forEach((o, i) => {
            const b = document.createElement('button'); b.className = 'option-btn'; b.innerText = `> ${o}`;
            b.onclick = () => processResult(i === q.answer, b);
            b.onmouseenter = () => AudioEngine.playMenuHover();
            optsList.appendChild(b);
        });
    }

    function processResult(isCorrect, btn) {
        questionsAttempted++;
        const all = document.querySelectorAll('.option-btn'); all.forEach(b => b.disabled = true);
        
        if (isCorrect) {
            btn.classList.add('correct'); currentScore++; integrity += 5; questionsCorrect++; currentStreak++;
            AudioEngine.playSFX('success'); showFloatText("ACCEPTED", btn, '#0f0');
        } else {
            btn.classList.add('wrong'); integrity -= 15; currentStreak = 0;
            AudioEngine.playSFX('error'); showFloatText("CORRUPT", btn, '#f00');
            // DAMAGE FLASH
            const cont = document.getElementById('integrity-cont');
            cont.classList.remove('dmg-shock'); void cont.offsetWidth; cont.classList.add('dmg-shock');
        }
        
        document.getElementById('explanation-box').style.display = 'block';
        document.getElementById('explanation-box').innerText = ">> ANALYSIS: " + window.currentQ.explanation;
        updateIntegrity();
        if(integrity > 0) document.getElementById('next-btn').classList.remove('hidden');
    }

    function nextSeq() { AudioEngine.playSFX('click'); loadSeq(); }

    function finish() {
        document.getElementById('quiz-ui').classList.add('hidden');
        document.getElementById('results-ui').classList.remove('hidden');
        document.getElementById('final-percent').innerText = Math.floor((questionsCorrect/questionsAttempted)*100) + "%";
    }

    function showFloatText(text, element, color) {
        const floatEl = document.createElement('div'); floatEl.className = 'float-text'; floatEl.innerText = text;
        floatEl.style.color = color; floatEl.style.textShadow = `0 0 10px ${color}`;
        document.getElementById('term-win').appendChild(floatEl); 
        const rect = element.getBoundingClientRect();
        floatEl.style.left = (rect.left + 50) + 'px'; floatEl.style.top = (rect.top - 20) + 'px';
        setTimeout(() => floatEl.remove(), 2000);
    }
    
    function showCrypto() {
        const addr = "kaspa:qqy08j0lcaunrga9pdq29sputscc8v5hjjyjlge93qye9aexejhxv43sq7tyq";
        alert("COPIED KASPA ADDRESS:\n" + addr); navigator.clipboard.writeText(addr);
    }

    /* === DATA & NAVIGATION === */
    const MASTER_DATABASE = [
        { tags: ["CORE1", "Hardware"], question: "A technician installs 16GB RAM, but Windows reports 4GB usable. Why?", options: ["OS is 32-bit (x86)", "RAM is unseated", "BIOS outdated", "Motherboard limitation"], answer: 0, explanation: "32-bit operating systems have a hard memory address limit of 4GB (2^32 addresses)." },
        { tags: ["CORE1", "Networking"], question: "Which port does SSH use?", options: ["21", "22", "23", "80"], answer: 1, explanation: "SSH uses port 22." }
    ];

    function fetchQuestions(tags) { return MASTER_DATABASE.filter(q => tags.every(t => q.tags.includes(t))); }
    
    function goToSubMenu(id) {
        document.getElementById('root-menu').classList.add('hidden');
        const m = document.getElementById(id+'-menu'); m.classList.remove('hidden');
        m.querySelectorAll('.btn').forEach((b,i) => setTimeout(() => { b.classList.add('visible'); b.classList.add('drift-active'); }, i*100));
    }
    
    function goToRoot() {
        document.querySelectorAll('[id$="-menu"]').forEach(e => e.classList.add('hidden'));
        document.getElementById('root-menu').classList.remove('hidden');
        document.querySelectorAll('#root-menu .btn').forEach((b,i) => setTimeout(() => { b.classList.add('visible'); b.classList.add('drift-active'); }, i*100));
    }

    function transitionToQuiz(c, m) { qQueue = fetchQuestions([c, m]); startQuiz(); }
    function startExam(c) { qQueue = fetchQuestions([c]); while(qQueue.length < 10) qQueue = qQueue.concat(qQueue); startQuiz(); }
    function startQuiz() { document.querySelectorAll('[id$="-menu"], #root-menu').forEach(e => e.classList.add('hidden')); document.getElementById('quiz-ui').classList.remove('hidden'); startHUD(); loadSeq(); }
</script>
</body>
</html>
