<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>COGITATOR</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <style>
        /* ==========================================================================
           1. CORE VARIABLES & RESET
           ========================================================================== */
        :root {
            --term-color: #0affba;    /* Neon Mint Default */
            --split-1: #ff0000;       /* RGB Split Red */
            --split-2: #00ffff;       /* RGB Split Cyan */
            --glow-color: rgba(10, 255, 186, 0.5);
            --hint-color: #ffd700;    
            
            /* Dynamic Animation Variables */
            --edge-opacity: 0;
            --shake-amp: 0px; 
            --glitch-amp: 1px;
            --sway-speed: 5s; 
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; cursor: none !important; }
        
        html, body { 
            height: 100%; 
            overflow: hidden; 
            margin: 0; 
            padding: 0; 
        }

        body {
            background-color: #000000;
            padding: 55px 20px 20px 20px; 
            font-family: 'VT323', monospace;
            color: var(--term-color);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            text-shadow: 0 0 1px var(--glow-color); 
            transition: color 0.4s ease, text-shadow 0.4s ease; 
        }

        ::-webkit-scrollbar { display: none; width: 0; background: transparent; }

        /* ==========================================================================
           2. BACKGROUND LAYERS (Matrix, Grid, Scanlines)
           ========================================================================== */
        .pixel-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            pointer-events: none; z-index: 900; 
            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px); 
        }
        
        #matrix-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; opacity: 0.25; }
        
        .retro-grid {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 45vh; z-index: -3;
            background: linear-gradient(transparent 0%, rgba(0, 255, 128, 0.1) 2%, transparent 3%), linear-gradient(90deg, transparent 0%, rgba(0, 255, 128, 0.1) 2%, transparent 3%);
            background-size: 50px 50px;
            transform: perspective(600px) rotateX(70deg) scale(2);
            opacity: 0.5;
            animation: grid-move 10s linear infinite;
        }

        #panic-pulse {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            pointer-events: none; z-index: 850;
            box-shadow: inset 0 0 150px #ff0000; 
            opacity: var(--edge-opacity);
            mix-blend-mode: overlay;
            animation: pulse-breath-erratic 4s infinite; 
        }

        .scan-line {
            position: fixed; left: 0; width: 100%;
            background: var(--term-color);
            opacity: 0.25; z-index: 600; pointer-events: none;
            box-shadow: 0 0 11px var(--term-color);
        }

        /* ==========================================================================
           3. MAIN TERMINAL WINDOW
           ========================================================================== */
        .terminal-window {
            width: 100%; max-width: 900px; height: 85vh; 
            border: 2px solid var(--term-color); 
            background: rgba(0, 5, 5, 0.85); 
            backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(10px);
            padding: 20px;
            display: none; flex-direction: column; position: relative;
            box-shadow: 5px 5px 0px rgba(0, 20, 20, 0.5), inset 0 0 20px rgba(0,0,0,0.5);
            transition: border-color 0.2s ease, filter 0.2s ease; 
            z-index: 100; overflow: hidden;
        }

        .terminal-window * { text-shadow: 1px 1px 2px #000; }
        .power-on { display: flex !important; animation: turnOn 0.8s cubic-bezier(0.23, 1, 0.32, 1) forwards; }
        .breath-active { animation: gui-breath 4s ease-in-out infinite !important; }

        /* --- Header Section --- */
        .header { 
            border-bottom: 4px solid var(--term-color);
            padding-bottom: 10px; margin-bottom: 15px; 
            display: flex; justify-content: space-between; align-items: flex-start;
            flex-shrink: 0; position: relative;
            transition: border-color 0.2s ease;
        }
        
        .h-left h1 { 
            margin: 0; font-size: 3.5rem; letter-spacing: 4px; line-height: 1;
            text-shadow: 4px 0 var(--split-1), -4px 0 var(--split-2);
            display: inline-block; font-weight: normal;
        }

        .status-container { display: flex; flex-direction: column; gap: 5px; margin-top: 5px; align-items: flex-start; }
        .status-line { font-size: 1.1rem; opacity: 0.9; color: var(--term-color); letter-spacing: 2px; transition: color 0.2s ease; }

        .stats-area { text-align: right; display: flex; flex-direction: column; align-items: flex-end; }
        .score-box { font-size: 1.5rem; font-weight: bold; margin-bottom: 5px; }

        /* --- Integrity & Temp Bars --- */
        .integrity-wrapper { width: 380px; text-align: right; transform-origin: center right; }
        .integrity-label { font-size: 0.8rem; letter-spacing: 2px; font-weight:bold; margin-bottom: 2px; display: flex; justify-content: space-between; }
        
        .integrity-container { 
            width: 100%; height: 25px; border: 2px solid var(--term-color); 
            padding: 2px; background: rgba(0,0,0,0.8); display: block; border-radius: 0;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.5);
        }
        
        .integrity-fill { 
            height: 100%; width: 100%; 
            box-shadow: 0 0 15px var(--term-color); 
            transition: width 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), background 0.2s ease, box-shadow 0.2s ease;
            background: repeating-linear-gradient(90deg, var(--term-color), var(--term-color) 8px, transparent 8px, transparent 10px);
            animation: health-pulse 1s infinite alternate;
        }

        /* ==========================================================================
           4. MENUS & UI ELEMENTS
           ========================================================================== */
        .menu-grid { 
            display: grid; grid-template-columns: 1fr; gap: 8px; margin-top: 5px;
            overflow-y: auto; padding-right: 5px; padding-bottom: 20px;
        }

        .btn { 
            background: rgba(0,0,0,0.5);
            border: 2px solid currentColor; color: var(--term-color); 
            font-family: 'VT323', monospace; font-size: 1.35rem;
            padding: 10px 15px; cursor: pointer; text-align: left; 
            transition: 0.1s; position: relative; overflow: hidden; 
            opacity: 0; transform: translateY(10px);
            box-shadow: 0 0 12px currentColor, 5px 5px 0px rgba(0,0,0,0.5); 
            text-shadow: 2px 2px 0px #000; border-radius: 0px;
        }

        .btn:hover { 
            background: #fff; color: #000 !important;
            box-shadow: 0 0 40px #fff; border-color: #fff; text-shadow: none; 
            z-index: 10; animation: rgb-split-hover 0.1s infinite !important; 
            transform: translate(-2px, -2px) !important; 
        }

        .btn.visible { opacity: 1 !important; transform: translateY(0); transition: opacity 0.5s ease, transform 0.5s ease; }
        .btn.drift-active { animation: random-drift 10s ease-in-out infinite alternate, neon-pulse 3s infinite alternate, text-flux 4s infinite; }

        .btn.exam-mode { color: #ff4444 !important; border-color: #ff4444 !important; box-shadow: 0 0 15px #ff4444, 5px 5px 0px rgba(0,0,0,0.5); }
        .btn.exam-mode:hover { background: #ff4444; color: white !important; box-shadow: 0 0 60px #ff4444; }
        
        .btn-back { color: #ffffff !important; border-color: #ffffff !important; box-shadow: 0 0 15px #ffffff, 5px 5px 0px rgba(0,0,0,0.5); }
        .btn-back:hover { background: #ffffff; color: #000 !important; box-shadow: 0 0 40px #ffffff; }

        .nav-btn { 
            margin-top: 20px; width: 100%; font-weight: bold; text-align: center; 
            background: rgba(0, 0, 0, 0.8); color: #ffffff;
            border: 1px solid #ffffff; font-size: 1.5rem; padding: 10px;
            cursor: pointer; border-radius: 0px; box-shadow: 5px 5px 0px rgba(0,0,0,0.8);
            opacity: 1 !important; transform: translateY(0) !important; transition: 0.2s;
        }
        .nav-btn:hover { background: #ffffff; color: #000000; box-shadow: 0 0 20px #ffffff; }

        /* Search Input Area */
        .search-area { margin-top: 20px; border-top: 1px dashed var(--term-color); padding-top: 10px; }
        .search-input { width: 100%; background: rgba(0,0,0,0.5); border: 1px solid var(--term-color); color: #fff; font-family: 'VT323'; font-size: 1.6rem; padding: 10px; outline: none; text-transform: uppercase; padding-right: 40px; }

        /* ==========================================================================
           5. QUIZ INTERFACE
           ========================================================================== */
        .quiz-container { 
            display: flex; flex-direction: column; flex-grow: 1; 
            overflow-y: auto; overflow-x: hidden; padding-right: 10px; position: relative;
        }
        .quiz-container::after { content: ""; display: block; min-height: 60px; flex-shrink: 0; width: 100%; }

        .quiz-header-bar {
            display:flex; justify-content:space-between; align-items:center; 
            border-bottom: 1px solid var(--term-color); padding-bottom: 10px; margin-bottom: 20px; 
            font-size: 1.3rem; flex-shrink: 0; position: sticky; top: 0;
            background: rgba(0, 5, 5, 0.95); z-index: 20; padding-top: 5px; 
        }

        .question-box { 
            font-size: 1.8rem; line-height: 1.3; margin-bottom: 20px; min-height: 80px; 
            background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent);
            border-left: 8px solid var(--term-color); padding-left: 20px; 
            color: #ffffff !important; text-shadow: 0 0 5px rgba(255,255,255,0.3), 1px 0 var(--split-1);
            animation: random-drift 7s ease-in-out infinite alternate, q-pulse 5s ease-in-out infinite;
            box-shadow: 3px 3px 0px rgba(0,0,0,0.3);
        }

        .explanation-box {
            margin-bottom: 20px; padding: 15px; border: 2px dashed var(--term-color);
            background: rgba(0,10,0,0.6); font-size: 1.6rem; color: #ffffff; 
            text-shadow: 0 0 8px rgba(255,255,255,0.4); white-space: normal; word-wrap: break-word; line-height: 1.4; 
            display: none;
        }

        .options-list { display: flex; flex-direction: column; gap: 15px; }
        
        .option-btn { 
            background: rgba(0, 0, 0, 0.7); border: 2px solid var(--term-color); 
            color: #ffffff !important; padding: 10px; font-family: 'VT323', monospace; 
            font-size: 1.35rem; text-align: left; cursor: pointer; transition: 0.1s;
            position: relative; overflow: hidden; border-radius: 0px; text-shadow: 2px 2px 0px #000;
            animation: text-flux 5s infinite; backdrop-filter: blur(8px); 
            box-shadow: 5px 5px 0px rgba(0,0,0,0.5);
        }
        
        .option-btn:hover { 
            background: #fff !important; padding-left: 25px; color: #000 !important; 
            border-color: #fff; box-shadow: 0 0 40px #fff; text-shadow: none;
            animation: rgb-split-hover 0.1s infinite !important;
        }
        
        .option-btn.correct { 
            background: var(--term-color) !important; color: black !important; border-color: white; 
            box-shadow: 0 0 80px var(--term-color) !important; text-shadow: none !important;
            animation: answer-thump 0.3s ease-out forwards !important; font-weight: bold;
        }
        
        .option-btn.wrong { 
            background: #a00 !important; color: white !important; border-color: red; 
            box-shadow: 0 0 80px red !important; animation: answer-shake 0.4s ease-in-out forwards !important;
        }

        /* --- Performance Based Questions (PBQ) --- */
        .pbq-wrapper { display: none; width: 100%; flex-direction: column; gap: 20px; }
        .cmd-input-line { display: flex; align-items: center; background: rgba(0,0,0,0.8); border: 1px solid var(--term-color); padding: 10px; font-size: 1.6rem; }
        #cmd-input { flex-grow: 1; background: transparent; border: none; color: #fff; font-family: inherit; font-size: inherit; text-transform: lowercase; outline: none; }
        
        .match-container { display: flex; justify-content: space-between; gap: 20px; margin-bottom: 20px; }
        .match-col { display: flex; flex-direction: column; gap: 15px; width: 48%; }
        .match-item { 
            border: 1px solid var(--term-color); background: rgba(0, 20, 20, 0.6);
            padding: 10px; text-align: center; cursor: pointer; font-size: 1.4rem; color: #fff;
            box-shadow: 3px 3px 0px rgba(0,0,0,0.5);
        }
        .match-item:hover { background: rgba(255,255,255,0.1); }
        .match-item.selected { background: var(--term-color); color: #000; box-shadow: 0 0 15px var(--term-color); }
        .match-item.matched { opacity: 0.5; border-color: #555; pointer-events: none; text-decoration: line-through; }
        .match-item.wrong { background: #a00; color: #fff; box-shadow: 0 0 15px #f00; }

        /* ==========================================================================
           6. RESULTS & GLOSSARY
           ========================================================================== */
        #results-ui {
            display: none; flex-direction: column; justify-content: flex-start; align-items: center;
            flex: 1; min-height: 0; width: 100%; /* Fix layout scrolling */
            text-align: center; overflow-y: auto; padding-top: 40px; padding-bottom: 60px;
        }

        .breakdown-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; font-size: 1.4rem; border-bottom: 1px dotted rgba(10, 255, 186, 0.3); }
        .bd-bar-bg { flex-grow: 1; height: 10px; background: rgba(255,255,255,0.1); margin: 0 15px; border: 1px solid #333; }
        .bd-bar-fill { height: 100%; transition: width 1s ease; }
        .bar-green { background: #00ff00; box-shadow: 0 0 10px #00ff00; }
        .bar-yellow { background: #ffcc00; box-shadow: 0 0 10px #ffcc00; }
        .bar-red { background: #ff0000; box-shadow: 0 0 10px #ff0000; }

        /* Glossary Overlay */
        #glossary-ui { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85); z-index: 9999;
            display: flex; justify-content: center; align-items: center; backdrop-filter: blur(5px);
        }
        .glossary-window { 
            width: 90%; max-width: 900px; height: 80vh; border: 2px solid var(--term-color);
            background: rgba(0, 10, 10, 0.95); box-shadow: 0 0 20px var(--term-color);
            display: flex; flex-direction: column; animation: turnOn 0.3s ease-out; overflow: hidden;
        }
        .gloss-view { width: 100%; flex: 1; min-height: 0; display: flex; flex-direction: column; }
        .glossary-header { background: var(--term-color); color: #000; padding: 10px; font-weight: bold; font-size: 1.2rem; display: flex; justify-content: space-between; align-items: center; }
        .glossary-tabs { display: flex; flex-wrap: wrap; border-bottom: 1px solid var(--term-color); background: rgba(0,0,0,0.5); }
        .tab-btn { flex: 1 1 auto; min-width: 90px; background: transparent; border: none; color: var(--term-color); font-family: 'VT323', monospace; font-size: 1.2rem; padding: 10px; cursor: pointer; }
        .tab-btn:hover, .tab-btn.active { background: var(--term-color); color: #000; }
        .glossary-grid { flex-grow: 1; overflow-y: auto; padding: 20px; display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 15px; align-content: start; }
        .gloss-item { border: 1px solid #444; padding: 15px; background: rgba(0, 0, 0, 0.6); cursor: pointer; position: relative; border-left: 3px solid transparent; }
        .gloss-item:hover { background: rgba(10, 255, 186, 0.1); border-left: 3px solid var(--term-color); padding-left: 15px; box-shadow: inset 0 0 15px rgba(10, 255, 186, 0.05); }

        /* ==========================================================================
           7. UTILITIES & WIDGETS
           ========================================================================== */
        /* Donate Widget */
        #donate-widget { position: fixed; top: 10px; right: 20px; display: flex; gap: 8px; z-index: 5000; pointer-events: auto; }
        .sys-btn { 
            background: rgba(0, 0, 0, 0.9); font-family: 'VT323', monospace; font-size: 1.3rem; 
            padding: 5px 12px; border: 1px solid; cursor: pointer; color: var(--term-color);
            text-shadow: 1px 1px 0 #000; box-shadow: 3px 3px 0px rgba(0,0,0,0.5); opacity: 0.9;
            animation: sys-btn-float 5s ease-in-out infinite;
        }
        .sys-btn:hover { opacity: 1; transform: translate(-1px, -1px); box-shadow: 0 0 15px currentColor; z-index: 5001; animation: none; }
        
        /* Study Guide Button */
        .study-guide-btn {
            position: fixed; top: 20px; left: 20px; z-index: 5000;
            color: #ff3333; border: 2px solid #ff3333; background: #000;
            font-family: 'VT323', monospace; font-size: 1.5rem; padding: 10px 20px;
            text-shadow: 0 0 10px #ff0000; box-shadow: 0 0 15px rgba(255, 0, 0, 0.4);
            cursor: pointer; transition: 0.2s;
        }
        .study-guide-btn:hover { background: #ff3333; color: #fff; box-shadow: 0 0 30px #ff0000; }

        /* Footer Ticker */
        .hacker-footer { 
            position: fixed; bottom: 0; left: 0; width: 100%; height: 25px; 
            background: rgba(0, 0, 0, 0.0); border-top: 0px solid rgba(10, 255, 186, 0.4); 
            overflow: hidden; z-index: 1000; display: flex; align-items: center; 
        }
        .ticker-content { display: inline-block; white-space: nowrap; font-size: 0.8rem; opacity: 0.5; animation: ticker-scroll 360s linear infinite; padding-left: 100%; }
        
        /* Audio Controls */
        .audio-btn { margin-top: 8px; font-size: 0.8rem; background: transparent; font-family: 'Courier New', monospace; border: 1px solid var(--term-color); color: inherit; cursor: pointer; padding: 2px 10px; transition: 0.2s; }
        .audio-btn:hover { background: #fff; color: #000; box-shadow: 0 0 15px #fff; }

        /* Custom Cursor */
        #custom-cursor { 
            position: fixed; width: 15px; height: 15px; border: 2px solid var(--term-color); 
            background-color: rgba(10, 255, 186, 0.05); box-shadow: 0 0 11px var(--term-color);
            z-index: 9999; pointer-events: none; transform: translate(-50%, -50%); mix-blend-mode: screen; 
        }

        /* Fail Screen */
        #fail-ui { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000; background: rgba(5, 0, 0, 0.95); flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        .fail-visible { display: flex !important; animation: fail-entry 0.3s ease-out forwards; }
        .fail-text { font-size: 4rem; font-family: 'Press Start 2P', cursive; color:#fff; animation: vertical-rgb-split 0.1s infinite, slice-glitch 0.3s infinite; text-shadow: 3px 0 red, -3px 0 blue; margin-bottom: 20px; }

        .hidden { display: none !important; }

        /* ==========================================================================
           8. ANIMATIONS (Keyframes)
           ========================================================================== */
        @keyframes turnOn { 0% { transform: scaleY(0.005) scaleX(0); opacity: 0; filter: brightness(4); } 60% { transform: scaleY(0.005) scaleX(1); opacity: 1; filter: brightness(2); } 100% { transform: scaleY(1) scaleX(1); opacity: 1; filter: brightness(1); } }
        @keyframes gui-breath { 0% { border-color: var(--term-color); box-shadow: 5px 5px 0px rgba(0, 20, 20, 0.5); } 50% { border-color: rgba(255, 255, 255, 0.5); box-shadow: 0 0 25px var(--term-color); } 100% { border-color: var(--term-color); box-shadow: 5px 5px 0px rgba(0, 20, 20, 0.5); } }
        @keyframes sys-btn-float { 0% { transform: translate(0, 0); } 25% { transform: translate(1px, 1px); } 50% { transform: translate(-1px, 1px); box-shadow: 0 0 15px currentColor; } 75% { transform: translate(2px, -1px); } 100% { transform: translate(0, 0); } }
        @keyframes health-pulse { 0% { opacity: 1; } 100% { opacity: 0.8; filter: brightness(1.2); } }
        @keyframes scan-drop { 0% { top: -10%; opacity: 0; } 10% { opacity: 0.35; } 100% { top: 110%; opacity: 0; } }
        @keyframes pulse-breath-erratic { 0% { opacity: var(--edge-opacity); } 50% { opacity: calc(var(--edge-opacity) * 0.4); } 100% { opacity: var(--edge-opacity); } }
        @keyframes rgb-split-hover { 0% { text-shadow: -1px 0 var(--split-1), 1px 0 var(--split-2); } 50% { text-shadow: 1px 0 var(--split-1), -1px 0 var(--split-2); } 100% { text-shadow: -1px 0 var(--split-1), 1px 0 var(--split-2); } }
        @keyframes slice-glitch { 0% { clip-path: inset(0 0 0 0); } 10% { clip-path: inset(10% 0 85% 0); transform: translate(-5px, 2px); } 100% { clip-path: inset(0 0 0 0); transform: translate(0); } }
        @keyframes random-drift { 0% { transform: translate(0, 0); } 40% { transform: translate(-1px, 2px); } 100% { transform: translate(0, 0); } }
        @keyframes text-flux { 0% { text-shadow: 2px 2px 0 #000; } 50% { text-shadow: 2px 2px 0 #000, 0 0 8px currentColor; } 100% { text-shadow: 2px 2px 0 #000; } }
        @keyframes grid-move { 0% { background-position: 0 0; } 100% { background-position: 0 100%; } }
        @keyframes ticker-scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
        @keyframes fail-entry { 0% { transform: scale(1.1); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes answer-thump { 0% { transform: scale(1); } 50% { transform: scale(1.05); box-shadow: 0 0 100px #fff; } 100% { transform: scale(1); } }
        @keyframes answer-shake { 0% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } 100% { transform: translateX(0); } }
        @keyframes intense-pulse { 0% { opacity: 0.7; filter: brightness(1); } 100% { opacity: 1; filter: brightness(3); } }
        @keyframes white-flash-anim { 0% { background-color: #ff0000; } 50% { background-color: #ffffff; box-shadow: 0 0 35px #ffffff; } 100% { background-color: #ff0000; } }

        /* Animation helper classes */
        .random-glitch-active { animation: rgb-split-hover 0.2s infinite !important; color: #fff !important; }
        .logo-glitch { animation: slice-glitch 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) both infinite !important; color: #fff !important; }
        .stress-active { animation: stress-shake 0.1s infinite !important; }
        @keyframes stress-shake { 0% { transform: translate(0, 0); } 25% { transform: translate(-1px, 1px); } 50% { transform: translate(1px, -1px); } 100% { transform: translate(0, 0); } }
        .integrity-critical { animation: crit-pulse 0.2s infinite !important; background: repeating-linear-gradient(90deg, #ff0000, #ff0000 8px, transparent 8px, transparent 10px) !important; box-shadow: 0 0 25px #ff0000 !important; }
        @keyframes crit-pulse { 0% { filter: brightness(1); opacity: 1; } 50% { filter: brightness(5); opacity: 0.8; } 100% { filter: brightness(1); opacity: 1; } }
        .dmg-shock { animation: damage-flash 0.6s cubic-bezier(0.1, 0.7, 1.0, 0.1); }
        @keyframes damage-flash { 0% { transform: scale(1); } 50% { transform: scale(1.15); filter: brightness(5) hue-rotate(180deg); } 100% { transform: scale(1); } }
        .temp-flash-white { animation: white-flash-anim 0.2s infinite !important; }
        .label-crit { animation: label-flash 0.3s infinite; }
        @keyframes label-flash { 0%, 100% { color: #ff0000; } 50% { color: #fff; } }
        .float-text { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; font-weight: bold; font-size: 3rem; pointer-events: none; animation: float-fade 2s forwards; z-index: 2000; }
        @keyframes float-fade { 0% { opacity: 1; transform: translate(-50%, -50%) scale(1); } 100% { opacity: 0; transform: translate(-50%, -150%) scale(1.5); } }
    </style>
</head>

<body class="glitch-active">

    <div id="custom-cursor"></div>
    <div class="pixel-overlay"></div>
    <canvas id="matrix-canvas"></canvas>
    <div class="retro-grid"></div>
    <div id="panic-pulse"></div> 
    <div id="scan-container"></div> 

    <button class="study-guide-btn" onclick="toggleGlossary()">[STUDY GUIDE]</button>

    <div id="donate-widget">
        <button class="sys-btn kofi-btn" onclick="window.open('https://ko-fi.com/worldeater888', '_blank')">[ SUPPORT ]</button>
        <button class="sys-btn coffee-btn" onclick="window.open('https://buymeacoffee.com/comptia_simulator', '_blank')">[ COFFEE ]</button>
        <button class="sys-btn kas-btn" onclick="showCrypto()">>> KASPA <<</button>
    </div>

    <div class="terminal-window" id="term-win">
        
        <div class="header">
            <div class="h-left">
                <h1 id="main-header">COMPTIA <span style="font-size: 0.6em; color:#fff;">SIMULATOR</span></h1>
                <div class="status-container">
                    <div class="jackpot-text status-line" id="status-text-1">> STATUS: WAITING...</div>
                    <div class="jackpot-text status-line" id="status-text-2">> NET: IDLE</div>
                </div>
            </div>
            
            <div class="stats-area">
                <div class="score-box" id="score-ui">UPLOADS: 0</div>
                
                <div class="integrity-wrapper" id="integrity-wrap">
                    <div class="integrity-label">
                        <span>CORE INTEGRITY</span><span id="integrity-num">100%</span>
                    </div>
                    <div class="integrity-container">
                        <div class="integrity-fill" id="integrity-bar"></div>
                    </div>
                </div>

                <div class="integrity-wrapper" id="temp-wrap" style="margin-top: 5px;">
                    <div class="integrity-label" id="temp-label" style="font-size: 0.7rem; color: #66ffd4;">
                        <span id="temp-text">SYSTEM STABLE</span><span id="temp-num">0%</span>
                    </div>
                    <div class="integrity-container" style="height: 12px; border: 1px solid var(--term-color);">
                        <div class="integrity-fill" id="temp-bar" style="width: 0%; background: #0affba;"></div>
                    </div>
                </div>

                <button id="sound-toggle" class="audio-btn" onclick="AudioEngine.toggleMute()">[ AUDIO: ON ]</button>
            </div>
        </div>

        <div id="root-menu">
            <p style="font-size: 1.2rem; border-bottom: 1px dashed var(--term-color); padding-bottom: 9px;">> SELECT_CERTIFICATION:</p>
            <div class="menu-grid">
                <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="goToSubMenu('core1')">[1] COMPTIA A+ CORE 1 <span style="float:right">>></span></button>
                <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="goToSubMenu('core2')">[2] COMPTIA A+ CORE 2 (under construction)<span style="float:right">>></span></button>
                <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="goToSubMenu('net')">[3] NETWORK+ (under construction)<span style="float:right">>></span></button>
                <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="goToSubMenu('sec')">[4] SECURITY+ (under construction)<span style="float:right">>></span></button>
                
                <div class="search-area">
                    <p style="font-size: 1rem; margin-bottom: 5px; opacity: 0.8;">> SEARCH_PROTOCOL // SYNTAX: "RAID", "PORT" OR [EXAM] + [TERM]</p>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <div style="flex-grow: 1; position: relative;">
                            <input type="text" id="topic-search-input" class="search-input" placeholder='TRY: "CORE 1 + RAID" OR "NET + WIFI"'>
                        </div>
                        <button class="btn" onclick="startTopicRun()" style="padding: 8px 20px; font-size: 1.2rem; opacity: 1; transform: none; margin: 0;">[ INITIATE ]</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="core1-menu" class="hidden">
            <p style="font-size: 1.2rem; border-bottom: 1px dashed var(--term-color); padding-bottom: 9px;">> CORE_1 // MODULES:</p>
            <div class="menu-grid">
                <button class="btn" onclick="transitionToQuiz('CORE1', 'Mobile')">[A] MOBILE DEVICES <span style="float:right">>></span></button>
                <button class="btn" onclick="transitionToQuiz('CORE1', 'Networking')">[B] NETWORKING <span style="float:right">>></span></button>
                <button class="btn" onclick="transitionToQuiz('CORE1', 'Hardware')">[C] HARDWARE <span style="float:right">>></span></button>
                <button class="btn" onclick="transitionToQuiz('CORE1', 'Cloud')">[D] VIRTUALIZATION & CLOUD <span style="float:right">>></span></button>
                <button class="btn" onclick="transitionToQuiz('CORE1', 'Troubleshoot')">[E] TROUBLESHOOTING <span style="float:right">>></span></button>
                <button class="btn exam-mode" onclick="startExam('CORE1')">[X] EXAM_SIMULATION <span style="float:right">>></span></button>
                <button class="btn btn-back" onclick="goToRoot()"> < BACK TO ROOT </button>
            </div>
        </div>

        <div id="core2-menu" class="hidden">
            <p style="font-size: 1.2rem; border-bottom: 1px dashed var(--term-color); padding-bottom: 9px;">> CORE_2 // MODULES:</p>
            <div class="menu-grid">
                <button class="btn" onclick="transitionToQuiz('CORE2', 'Operating Systems')">[A] OPERATING SYSTEMS <span style="float:right">>></span></button>
                <button class="btn" onclick="transitionToQuiz('CORE2', 'Security')">[B] SECURITY <span style="float:right">>></span></button>
                <button class="btn exam-mode" onclick="startExam('CORE2')">[X] EXAM_SIMULATION <span style="float:right">>></span></button>
                <button class="btn btn-back" onclick="goToRoot()"> < BACK TO ROOT </button>
            </div>
        </div>

        <div id="net-menu" class="hidden">
            <p style="font-size: 1.2rem; border-bottom: 1px dashed var(--term-color); padding-bottom: 9px;">> NET+ // MODULES:</p>
            <div class="menu-grid">
                <button class="btn" onclick="transitionToQuiz('NET', 'Networking Fundamentals')">[A] NETWORKING FUNDAMENTALS <span style="float:right">>></span></button>
                <button class="btn exam-mode" onclick="startExam('NET')">[X] EXAM_SIMULATION <span style="float:right">>></span></button>
                <button class="btn btn-back" onclick="goToRoot()"> < BACK TO ROOT </button>
            </div>
        </div>

        <div id="sec-menu" class="hidden">
            <p style="font-size: 1.2rem; border-bottom: 1px dashed var(--term-color); padding-bottom: 9px;">> SEC+ // MODULES:</p>
            <div class="menu-grid">
                <button class="btn" onclick="transitionToQuiz('SEC', 'General Concepts')">[A] GENERAL CONCEPTS <span style="float:right">>></span></button>
                <button class="btn exam-mode" onclick="startExam('SEC')">[X] EXAM_SIMULATION <span style="float:right">>></span></button>
                <button class="btn btn-back" onclick="goToRoot()"> < BACK TO ROOT </button>
            </div>
        </div>

        <div id="quiz-ui" class="hidden quiz-container">
            <div class="quiz-header-bar">
                <div style="display:flex; gap: 20px;">
                    <span onclick="shutdownSystem()" onmouseenter="AudioEngine.playOptionHover()" class="abort-btn">< ABORT</span>
                    <span style="color:var(--term-color);">[REACTOR]: <span id="session-timer" style="color:#fff; font-weight:bold;">90:00</span></span>
                    <span style="color:var(--term-color);">[PACKETS]: <span id="packet-counter" style="color:#fff; font-weight:bold;">00</span></span>
                </div>
                <span id="streak-text" style="font-weight: bold;">SYNCS: 0</span>
            </div>
            
            <div class="question-box"><span id="q-text" class="jackpot-text"></span></div>
            <div id="explanation-box" class="explanation-box"></div>
            <div class="options-list" id="opts-list"></div>

            <div id="pbq-area" class="pbq-wrapper"></div>
            <button id="pbq-submit-btn" class="btn" style="width: 50%; margin: 10px auto; display: none; background: var(--term-color); color: #000;" onclick="submitPBQ()">[ EXECUTE_COMMAND ]</button>
            
            <button class="btn nav-btn hidden" id="next-btn" onmouseenter="AudioEngine.playMenuHover()" onclick="nextSeq()" style="margin-bottom: 10px;">>> NEXT_PACKET >> </button>
        </div>

        <div id="results-ui" class="hidden">
            <h1 style="font-size: 4rem; margin-bottom: 0px;" id="final-percent">0%</h1>
            <p style="font-size: 2rem; margin-bottom: 10px;">> DIAGNOSTIC_COMPLETE</p>
            <div id="breakdown-container" style="width: 100%; max-width: 700px; margin: 20px auto 0 auto; border-top: 2px dashed var(--term-color); padding-top: 15px; text-align: left; display: none;"></div>
            <button class="btn nav-btn" style="margin-top: 20px; margin-bottom: 40px;" onmouseenter="AudioEngine.playMenuHover()" onclick="location.reload()">>> REBOOT_SYSTEM <<</button>
        </div>

        <div id="secondary-status" class="jackpot-text" style="position: absolute; bottom: 5px; left: 10px; font-size: 1rem; opacity: 0.6; pointer-events: none;"></div>
        <div id="warning-area" style="width: 100%; text-align: center; margin-top: auto; padding-top: 10px;"><div id="crit-warn" class="system-msg" style="display:none; color: red;"></div></div>

    </div>

    <div id="fail-ui">
        <h1 class="fail-text">CORRUPTION</h1>
        <p style="font-size: 2rem; color: #ccffff; text-shadow: 0 0 5px #ccffff;"> _ALL_IS_LOST_</p>
        <button class="nav-btn fail-restart-btn" onclick="location.reload()" style="background: rgba(255,0,0,0.3) !important; border-color: red !important;">>> PURGE_SYSTEM</button>
    </div>

    <div id="glossary-ui" class="hidden">
        <div class="glossary-window">
            <div class="glossary-header">
                <span id="gloss-title">>> SELECT_DATABASE</span>
                <div>
                    <button id="gloss-back-btn" class="close-btn hidden" style="margin-right: 15px;" onclick="showExamSelection()">[ < BACK ]</button>
                    <button class="close-btn" onclick="toggleGlossary()">[ X ]</button>
                </div>
            </div>
            
            <div id="gloss-select-view" class="gloss-view">
                <div class="exam-select-grid">
                    <button class="exam-select-btn" onclick="loadGlossaryExam('CORE1')"><span class="ex-title">CORE 1</span><span class="ex-sub">HARDWARE/NETWORK</span></button>
                    <button class="exam-select-btn" onclick="loadGlossaryExam('CORE2')"><span class="ex-title">CORE 2</span><span class="ex-sub">SOFTWARE/SECURITY</span></button>
                    <button class="exam-select-btn" onclick="loadGlossaryExam('NET')"><span class="ex-title">NETWORK+</span><span class="ex-sub">INFRASTRUCTURE</span></button>
                    <button class="exam-select-btn" onclick="loadGlossaryExam('SEC')"><span class="ex-title">SECURITY+</span><span class="ex-sub">CYBERSECURITY</span></button>
                </div>
            </div>

            <div id="gloss-content-view" class="gloss-view hidden">
                <div id="gloss-tabs" class="glossary-tabs"></div>
                <div id="glossary-content" class="glossary-grid"></div>
            </div>
        </div>
    </div>

    <div class="hacker-footer">
        <div class="ticker-content">
            >> SYS_LOG_START [0x1A4F] >> This is an open-source interactive study tool for CompTIA A+ students. IDENTITY: OPEN_SOURCE_COMPTIA_TRAINING_SIMULATOR_V2.9 >> STATUS: ONLINE...
            [ ABOUT_SYSTEM ] This browser-based terminal simulator serves as a comprehensive training environment.
            >> DISCLAIMER: THIS_PROJECT_IS_AN_INDEPENDENT_STUDY_TOOL_AND_IS_NOT_AFFILIATED_WITH_COMPTIA. 
            >> END_LOG [0xFFFF] >> WAITING_FOR_INPUT...
        </div>
    </div>

<script src="db_init.js"></script>
<script src="questions_core1.js"></script>

<script>
    /* =========================================================================
       REGION 1: GLOBAL STATE
       ========================================================================= */
    let matchState = { selected: null, pairsFound: 0 }; 
    let qQueue = []; let currentScore = 0; window.integrity = 100;
    let explainTimer = null;
    let currentStreak = 0; let isExam = false; let questionsCorrect = 0; let questionsAttempted = 0; let isDead = false;
    let quizHistory = []; 
    let hudInterval = null; let sessionTime = 5400; 
    let tempLevel = 0; const TEMP_MAX = 100;
    let tagLedger = {}; 
    let currentGlossaryExam = null;

    const EXAM_BLUEPRINTS = {
        'CORE1': { 'Mobile': 0.14, 'Networking': 0.20, 'Hardware': 0.27, 'Cloud': 0.12, 'Troubleshoot': 0.27 },
        'CORE2': { 'Operating Systems': 0.27, 'Security': 0.24, 'Software Troubleshooting': 0.26, 'Operational Procedures': 0.23 },
        'NET': { 'Networking Fundamentals': 0.24, 'Network Implementation': 0.19, 'Network Operations': 0.16, 'Network Security': 0.19, 'Network Troubleshooting': 0.22 },
        'SEC': { 'General Concepts': 0.12, 'Threats & Vulnerabilities': 0.22, 'Security Architecture': 0.20, 'Security Operations': 0.26, 'Management & Governance': 0.20 }
    };

    const GLOSSARY_DATA = {
        'CORE1': {
            'PORTS': [
                { k: "20/21", v: "FTP (File Transfer). TCP. Unsecured." },
                { k: "22", v: "SSH (Secure Shell). TCP. Encrypted Login." },
                { k: "23", v: "Telnet. TCP. Unencrypted Login." },
                { k: "25", v: "SMTP (Sending Mail). TCP." },
                { k: "53", v: "DNS (Domain Name System). UDP/TCP." },
                { k: "67/68", v: "DHCP (Dynamic Host Config). UDP." },
                { k: "80", v: "HTTP (Web). TCP. Unsecured." },
                { k: "110", v: "POP3 (Receiving Mail). TCP. Downloads & deletes." },
                { k: "143", v: "IMAP (Receiving Mail). TCP. Syncs across devices." },
                { k: "443", v: "HTTPS (Secure Web). TCP. Encrypted." },
                { k: "3389", v: "RDP (Remote Desktop). TCP/UDP." }
            ],
            'HARDWARE': [
                { k: "ATX", v: "12 x 9.6 in. Standard desktop size. 7 expansion slots." },
                { k: "Micro-ATX", v: "9.6 x 9.6 in. Smaller. 4 expansion slots." },
                { k: "Mini-ITX", v: "6.7 x 6.7 in. Smallest. 1 expansion slot." },
                { k: "M.2 Key M", v: "NVMe/PCIe SSDs (Fastest)." }
            ],
            'RAID': [
                { k: "RAID 0", v: "Striping. Speed++. 0 Redundancy. (Min 2 Drives)" },
                { k: "RAID 1", v: "Mirroring. Redundancy++. Slow Write. (Min 2 Drives)" },
                { k: "RAID 5", v: "Striping + Parity. Speed + Safety. (Min 3 Drives)" }
            ]
        },
        'CORE2': { 'COMING SOON': [{ k: "STATUS", v: "UNDER CONSTRUCTION" }] },
        'NET': { 'COMING SOON': [{ k: "STATUS", v: "UNDER CONSTRUCTION" }] },
        'SEC': { 'COMING SOON': [{ k: "STATUS", v: "UNDER CONSTRUCTION" }] }
    };

    /* =========================================================================
       REGION 2: AUDIO ENGINE
       ========================================================================= */
    const AudioEngine = {
        ctx: null, masterGain: null, delayNode: null, isPlaying: false, isMuted: false, 
        init: function() {
            try {
                const AC = window.AudioContext || window.webkitAudioContext;
                this.ctx = new AC();
                this.masterGain = this.ctx.createGain();
                this.masterGain.gain.value = 0.3;
                this.masterGain.connect(this.ctx.destination);
                this.delayNode = this.ctx.createDelay(); this.delayNode.delayTime.value = 0.35;
                const feedback = this.ctx.createGain(); feedback.gain.value = 0.4;
                this.delayNode.connect(feedback); feedback.connect(this.delayNode); this.delayNode.connect(this.masterGain);
                if (this.ctx.state === 'suspended') this.ctx.resume();
                this.playBoot(); this.startMusic();
            } catch(e) { console.log(e); }
        },
        startMusic: function() { if(this.isPlaying) return; this.isPlaying = true; this.musicLoop(); },
        musicLoop: function() {
            if (!this.isPlaying) return;
            const now = this.ctx.currentTime;
            const drone = this.ctx.createOscillator(); const droneGain = this.ctx.createGain();
            drone.type = 'sine'; drone.frequency.value = 55; 
            droneGain.gain.setValueAtTime(0.05, now);
            droneGain.gain.linearRampToValueAtTime(0, now + 6);
            drone.connect(droneGain); droneGain.connect(this.masterGain); drone.start(now); drone.stop(now + 6);
            setTimeout(() => this.musicLoop(), 4500); 
        },
        playSFX: function(type) {
            if (!this.ctx || this.isMuted) return;
            const t = this.ctx.currentTime;
            const osc = this.ctx.createOscillator(); const g = this.ctx.createGain();
            osc.connect(g); g.connect(this.masterGain);
            if (type === 'data') { osc.type = 'square'; osc.frequency.setValueAtTime(2000+Math.random()*1000, t); g.gain.setValueAtTime(0.01, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.05); osc.start(t); osc.stop(t+0.05); }
            else if (type === 'type') { osc.type = 'square'; osc.frequency.setValueAtTime(2000+Math.random()*1000, t); g.gain.setValueAtTime(0.01, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.03); osc.start(t); osc.stop(t+0.03); }
            else if (type === 'click') { osc.type = 'square'; osc.frequency.setValueAtTime(800, t); g.gain.setValueAtTime(0.01, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.05); osc.start(t); osc.stop(t+0.05); } 
            else if (type === 'success') { osc.type = 'sine'; osc.frequency.setValueAtTime(600, t); osc.frequency.exponentialRampToValueAtTime(1200, t+0.1); g.gain.setValueAtTime(0.1, t); g.gain.linearRampToValueAtTime(0, t+0.2); g.connect(this.delayNode); osc.start(t); osc.stop(t+0.2); } 
            else if (type === 'error') { osc.type = 'triangle'; osc.frequency.setValueAtTime(150+Math.random()*50, t); osc.frequency.linearRampToValueAtTime(50, t+0.4); g.gain.setValueAtTime(0.2, t); g.gain.linearRampToValueAtTime(0, t+0.4); osc.start(t); osc.stop(t+0.4); } 
            else if (type === 'healthup') { osc.type = 'triangle'; osc.frequency.setValueAtTime(400, t); osc.frequency.linearRampToValueAtTime(800, t+0.2); g.gain.setValueAtTime(0.1, t); g.gain.linearRampToValueAtTime(0, t+0.3); g.connect(this.delayNode); osc.start(t); osc.stop(t+0.3); }
        },
        playMenuHover: function() {
            if (!this.ctx || this.isMuted) return;
            const t = this.ctx.currentTime;
            const osc = this.ctx.createOscillator(); const g = this.ctx.createGain();
            osc.frequency.setValueAtTime(600 + Math.random() * 800, t);
            g.gain.setValueAtTime(0.02, t); g.gain.exponentialRampToValueAtTime(0.001, t + 0.15); 
            osc.connect(g); g.connect(this.masterGain); osc.start(t); osc.stop(t + 0.15);
        },
        playOptionHover: function() { this.playMenuHover(); },
        playGameOver: function() { 
            if (!this.ctx || this.isMuted) return;
            const t = this.ctx.currentTime;
            const osc = this.ctx.createOscillator(); const g = this.ctx.createGain();
            osc.type = 'triangle'; osc.frequency.setValueAtTime(100, t);
            osc.frequency.exponentialRampToValueAtTime(10, t + 4);
            g.gain.setValueAtTime(0.5, t); g.gain.linearRampToValueAtTime(0, t + 4);
            osc.connect(g); g.connect(this.masterGain); osc.start(t); osc.stop(t + 4);
        },
        playExpType: function() { this.playMenuHover(); }, // Reuse for simplicity
        playBoot: function() {
            if (!this.ctx || this.isMuted) return;
            const t = this.ctx.currentTime;
            const osc = this.ctx.createOscillator(); const g = this.ctx.createGain();
            osc.type = 'sine'; osc.frequency.setValueAtTime(50, t);
            osc.frequency.exponentialRampToValueAtTime(600, t + 0.5);
            g.gain.setValueAtTime(0, t); g.gain.linearRampToValueAtTime(0.2, t + 0.1); g.gain.linearRampToValueAtTime(0, t + 0.5);
            osc.connect(g); g.connect(this.masterGain); osc.start(t); osc.stop(t + 0.5);
        },
        toggleMute: function() {
            this.isMuted = !this.isMuted;
            if(this.masterGain) this.masterGain.gain.setTargetAtTime(this.isMuted ? 0 : 0.3, this.ctx.currentTime, 0.1);
            document.getElementById('sound-toggle').innerText = this.isMuted ? "[ AUDIO: OFF ]" : "[ AUDIO: ON ]";
        }
    };

    /* =========================================================================
       REGION 3: VISUAL FX (Cursor, Matrix, Glitch)
       ========================================================================= */
    const VisualFX = {
        init: function() {
            this.initCursor();
            this.initMatrix();
            this.startScanlines();
            this.startFluffText();
            this.startRandomGlitch();
        },
        initCursor: function() {
            const cursor = document.getElementById('custom-cursor');
            document.addEventListener('mousemove', (e) => {
                cursor.style.left = e.clientX + 'px'; cursor.style.top = e.clientY + 'px';
                if(Math.random() > 0.6) {
                    const trail = document.createElement('div');
                    trail.style.position = 'fixed'; trail.style.left = e.clientX + 'px'; trail.style.top = e.clientY + 'px';
                    trail.style.width = '20px'; trail.style.height = '20px';
                    trail.style.border = `1px solid var(--term-color)`; trail.style.opacity = 0.5;
                    document.body.appendChild(trail);
                    setTimeout(() => { trail.style.opacity = 0; }, 50);
                    setTimeout(() => { trail.remove(); }, 500);
                }
            });
            document.addEventListener('mousedown', () => { cursor.style.transform = 'translate(-50%, -50%) scale(0.8)'; });
            document.addEventListener('mouseup', () => { cursor.style.transform = 'translate(-50%, -50%) scale(1)'; });
        },
        initMatrix: function() {
            const canvas = document.getElementById('matrix-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            const fontSize = 14; 
            const columns = Math.floor(canvas.width / fontSize);
            const drops = Array(columns).fill(1); 
            const baseChars = "01010x<>!@#{}[]ZEUS"; 

            function drawRain() {
                if(Math.random() > 0.5) { requestAnimationFrame(drawRain); return; } 
                ctx.fillStyle = 'rgba(0, 0, 0, 0.05)'; 
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#0affba'; 
                ctx.font = fontSize + 'px monospace';
                for(let i=0; i<drops.length; i++) {
                    const char = baseChars[Math.floor(Math.random()*baseChars.length)];
                    ctx.fillText(char, i*fontSize, drops[i]*fontSize);
                    if(drops[i]*fontSize > canvas.height && Math.random() > 0.99) drops[i] = 0;
                    drops[i]++;
                }
                requestAnimationFrame(drawRain);
            }
            drawRain();
        },
        startScanlines: function() {
            function spawn() {
                if(isDead) return;
                const container = document.getElementById('scan-container');
                const line = document.createElement('div');
                line.className = 'scan-line';
                line.style.height = (Math.random() * 3 + 1) + 'px';
                line.style.animation = `scan-drop ${Math.random() * 5 + 4}s linear forwards`;
                container.appendChild(line);
                setTimeout(() => line.remove(), 10000);
                setTimeout(spawn, Math.random() * 8000 + 6000); 
            }
            spawn();
        },
        startFluffText: function() {
            const techPhrases = ["> SYSTEM: PURGING", "> NET: CONNECTED", "> DATA: FLOWING", "> ENCRYPTION: ACTIVE", "> KERNEL: PANIC", "> BUFFER: OVERFLOW"];
            function cycle() {
                if(isDead) return;
                document.getElementById('status-text-1').innerText = techPhrases[Math.floor(Math.random() * techPhrases.length)];
                setTimeout(cycle, 5000 + Math.random() * 10000);
            }
            cycle();
        },
        startRandomGlitch: function() {
            function trigger() {
                if(isDead) return;
                const chaos = 1 - (integrity / 100);
                if(Math.random() < (0.1 + chaos * 0.6)) {
                    const targets = document.querySelectorAll('.btn, h1, .status-line');
                    if(targets.length > 0) {
                        const t = targets[Math.floor(Math.random()*targets.length)];
                        t.classList.add('random-glitch-active');
                        setTimeout(() => t.classList.remove('random-glitch-active'), 200);
                    }
                }
                setTimeout(trigger, 200 + (integrity * 5));
            }
            trigger();
        },
        showFloatText: function(text, color) {
            const floatEl = document.createElement('div');
            floatEl.className = 'float-text'; floatEl.innerText = text;
            floatEl.style.color = color; floatEl.style.textShadow = `0 0 10px ${color}`;
            document.getElementById('term-win').appendChild(floatEl); 
            setTimeout(() => floatEl.remove(), 2000);
        },
        scrambleText: function(element, finalString, duration=500) {
            const alphabet = "0101010101XYZ<>";
            let start = Date.now();
            function update() {
                let now = Date.now();
                let prog = (now - start) / duration;
                if(prog >= 1) { element.innerText = finalString; return; }
                let txt = "";
                for(let i=0; i<finalString.length; i++) {
                    if(i < finalString.length * prog) txt += finalString[i];
                    else txt += alphabet[Math.floor(Math.random()*alphabet.length)];
                }
                element.innerText = txt; 
                requestAnimationFrame(update);
            }
            update();
        },
        typeExplain: function(element, text) {
            if (explainTimer) { clearTimeout(explainTimer); explainTimer = null; }
            element.style.display = 'block'; element.innerHTML = "";
            let i = 0;
            function type() {
                if (i < text.length) {
                    let char = text.charAt(i); if (char === " ") char = "&nbsp;"; 
                    element.innerHTML += char; i++;
                    if (i % 2 === 0) AudioEngine.playExpType();
                    explainTimer = setTimeout(type, 20); 
                } else { explainTimer = null; }
            }
            type();
        }
    };

    /* =========================================================================
       REGION 4: GAME LOGIC & HUD
       ========================================================================= */
    const GameEngine = {
        bootSystem: function() {
            AudioEngine.init(); 
            VisualFX.init();
            
            const term = document.getElementById('term-win');
            term.classList.remove('power-off'); 
            term.classList.add('power-on');
            setTimeout(() => { term.classList.add('breath-active'); }, 850);
            
            // Animate buttons in
            document.querySelectorAll('#root-menu .btn').forEach((b, i) => { 
                setTimeout(() => {
                    b.classList.add('visible');
                    setTimeout(() => b.classList.add('drift-active'), 500); 
                }, 500 + (i * 150)); 
            });
        },
        updateSystemState: function() {
            if (integrity > 100) integrity = 100;
            if (integrity < 0) integrity = 0;
            
            const bar = document.getElementById('integrity-bar'); 
            bar.style.width = `${integrity}%`;
            document.getElementById('score-ui').innerText = `SCORE: ${currentScore}`;
            document.getElementById('streak-text').innerText = `SYNCS: ${currentStreak}`;
            
            const intNum = document.getElementById('integrity-num');
            intNum.innerText = `${Math.floor(integrity)}%`;
            if(integrity < 30) intNum.classList.add('label-crit'); else intNum.classList.remove('label-crit');

            const warn = document.getElementById('crit-warn');
            if (integrity <= 0) warn.style.display = 'none';
            else if (integrity < 25) { warn.style.display = 'inline-block'; warn.innerText = ">> CRITICAL FAILURE <<"; }
            else warn.style.display = 'none';

            // Dynamic Color Shift based on health
            const root = document.documentElement; 
            let hue = integrity > 50 ? 140 + ((integrity - 50) * 0.4) : integrity * 1.2;
            root.style.setProperty('--term-color', `hsl(${hue}, 100%, 50%)`);
            
            if (integrity <= 0 && !isDead) this.triggerFailure();
        },
        triggerFailure: function() { 
            isDead = true;
            document.getElementById('fail-ui').classList.add('fail-visible'); 
            AudioEngine.playGameOver(); 
        },
        startHUD: function() {
            if (hudInterval) clearInterval(hudInterval);
            document.getElementById('packet-counter').innerText = qQueue.length.toString().padStart(3, '0');
            
            hudInterval = setInterval(() => {
                if(isDead) { clearInterval(hudInterval); return; }
                if (sessionTime > 0) sessionTime--;
                let mins = Math.floor(sessionTime / 60);
                let secs = sessionTime % 60;
                document.getElementById('session-timer').innerText = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;

                if (document.getElementById('next-btn').classList.contains('hidden')) {
                    if (tempLevel < TEMP_MAX) tempLevel++;
                    this.updateTempVisuals();
                }
            }, 1000);
        },
        updateTempVisuals: function() {
            const bar = document.getElementById('temp-bar');
            const labelNum = document.getElementById('temp-num');
            const labelText = document.getElementById('temp-text');
            
            const pct = Math.min(tempLevel / TEMP_MAX, 1);
            const hue = Math.max(0, 120 - (pct * 120)); 
            const color = `hsl(${hue}, 100%, 50%)`;

            labelNum.innerText = `${tempLevel}%`; labelNum.style.color = color;
            labelText.style.color = color;
            bar.style.width = `${pct * 100}%`; bar.style.backgroundColor = color; bar.style.boxShadow = `0 0 15px ${color}`;

            let msg = tempLevel < 55 ? "SYSTEM STABLE" : ">> DANGER: SYSTEM INSTABLE <<";
            if(tempLevel >= 85) msg = "!! SYSTEM OVERLOAD !!";
            labelText.innerText = msg;

            if(tempLevel >= 75) bar.classList.add('temp-flash-white'); else bar.classList.remove('temp-flash-white');
        },
        resetTemp: function() {
            tempLevel = 0;
            this.updateTempVisuals();
        },
        resetGame: function() {
            currentScore = 0; integrity = 100; currentStreak = 0; questionsCorrect = 0; questionsAttempted = 0; isDead = false;
            quizHistory = []; tagLedger = {};
            this.updateSystemState();
            document.getElementById('crit-warn').style.display = 'none';
            document.getElementById('fail-ui').style.display = 'none';
            document.getElementById('fail-ui').classList.remove('fail-visible'); 
            document.getElementById('breakdown-container').style.display = 'none';
        }
    };

    /* =========================================================================
       REGION 5: QUESTION & UI MANAGEMENT
       ========================================================================= */
    function fetchQuestions(requiredTags) {
        return MASTER_DATABASE.filter(q => requiredTags.every(tag => q.tags.includes(tag)));
    }

    function fetchQuestionsByKeyword(input) {
        let term = input.trim();
        if (!term) return [];
        let targetTag = null;
        if (term.includes('+')) {
            const parts = term.split('+');
            const potentialCategory = parts[0].trim().toLowerCase();
            const categoryMap = { 'core 1': 'CORE1', 'core 2': 'CORE2', 'net': 'NET', 'sec': 'SEC' };
            if (categoryMap[potentialCategory]) { targetTag = categoryMap[potentialCategory]; term = parts.slice(1).join('+').trim(); }
        }
        const safeTerm = term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        const regex = new RegExp(`(?:^|[^a-z0-9])${safeTerm}(?:$|[^a-z0-9])`, 'i');
        return MASTER_DATABASE.filter(q => {
            if (targetTag && !q.tags.includes(targetTag)) return false;
            return regex.test(q.question + " " + (q.explanation || "") + " " + (q.hint || ""));
        });
    }

    function startTopicRun() {
        const keyword = document.getElementById('topic-search-input').value;
        if (!keyword) { alert(">> ERROR: INPUT_EMPTY"); return; }
        qQueue = fetchQuestionsByKeyword(keyword);
        if (qQueue.length === 0) { alert(`>> ERROR: DATA_NOT_FOUND [${keyword.toUpperCase()}]`); return; }
        // Shuffle
        for (let i = qQueue.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [qQueue[i], qQueue[j]] = [qQueue[j], qQueue[i]]; }
        if (qQueue.length > 25) qQueue = qQueue.slice(0, 25);
        isExam = false; GameEngine.resetGame(); sessionTime = 5400;
        switchScreen('root-menu', 'quiz-ui', () => { GameEngine.startHUD(); loadSeq(); });
    }

    function transitionToQuiz(certTag, moduleTag) {
        qQueue = fetchQuestions([certTag, moduleTag]);
        for (let i = qQueue.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [qQueue[i], qQueue[j]] = [qQueue[j], qQueue[i]]; }
        if (qQueue.length > 25) qQueue = qQueue.slice(0, 25);
        if(qQueue.length === 0) { alert(`NO DATA`); return; }
        isExam = false; GameEngine.resetGame(); sessionTime = 5400; 
        
        let fromMenu = 'root-menu';
        if(certTag === 'CORE1') fromMenu = 'core1-menu';
        if(certTag === 'CORE2') fromMenu = 'core2-menu';
        if(certTag === 'NET') fromMenu = 'net-menu';
        if(certTag === 'SEC') fromMenu = 'sec-menu';
        
        switchScreen(fromMenu, 'quiz-ui', () => { GameEngine.startHUD(); loadSeq(); });
    }

    function startExam(certTag) {
        const blueprint = EXAM_BLUEPRINTS[certTag];
        let examDeck = [];
        for (const [moduleName, weight] of Object.entries(blueprint)) {
            const count = Math.ceil(90 * weight);
            const pool = fetchQuestions([certTag, moduleName]);
            for (let i = pool.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [pool[i], pool[j]] = [pool[j], pool[i]]; }
            examDeck = examDeck.concat(pool.slice(0, count));
        }
        for (let i = examDeck.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [examDeck[i], examDeck[j]] = [examDeck[j], examDeck[i]]; }
        qQueue = examDeck.slice(0, 90); 
        if(qQueue.length === 0) { alert(`NO DATA`); return; }
        isExam = true; GameEngine.resetGame(); sessionTime = 5400; 
        
        let fromMenu = 'root-menu';
        if(certTag === 'CORE1') fromMenu = 'core1-menu';
        else if(certTag === 'CORE2') fromMenu = 'core2-menu';
        else if(certTag === 'NET') fromMenu = 'net-menu';
        else if(certTag === 'SEC') fromMenu = 'sec-menu';

        switchScreen(fromMenu, 'quiz-ui', () => { GameEngine.startHUD(); loadSeq(); });
    }

    function loadSeq() {
        if (integrity <= 0) return;
        GameEngine.resetTemp();
        document.getElementById('explanation-box').style.display = 'none';
        document.getElementById('opts-list').style.display = 'none';
        document.getElementById('pbq-area').style.display = 'none';
        document.getElementById('pbq-submit-btn').style.display = 'none';
        document.getElementById('next-btn').classList.add('hidden');

        if (qQueue.length === 0) { finish(); return; }
        
        const q = qQueue.pop();
        window.currentQ = q; 
        document.getElementById('packet-counter').innerText = qQueue.length.toString().padStart(3, '0');
        VisualFX.scrambleText(document.getElementById('q-text'), q.question, 600);

        if (q.type === 'terminal' || q.type === 'match') renderPBQ(q);
        else {
            document.getElementById('opts-list').style.display = 'flex';
            renderMCQ(q);
        }
    }

    function renderMCQ(q) {
        const optsList = document.getElementById('opts-list');
        optsList.innerHTML = '';
        let opts = q.options.map((t, i) => ({ t, isC: i === q.answer }));
        for (let k = opts.length - 1; k > 0; k--) { const j = Math.floor(Math.random() * (k + 1)); [opts[k], opts[j]] = [opts[j], opts[k]]; }
        opts.forEach(o => {
            const b = document.createElement('button'); b.className = 'option-btn'; b.innerText = `> ${o.t}`;
            b.onmouseenter = () => AudioEngine.playOptionHover();
            b.onclick = () => processResult(o.isC, b, opts); 
            optsList.appendChild(b);
        });
    }

    function renderPBQ(q) {
        const container = document.getElementById('pbq-area');
        container.innerHTML = ''; container.style.display = 'flex';
        document.getElementById('pbq-submit-btn').style.display = 'block';

        if (q.type === 'terminal') {
            container.innerHTML = `
                <div class="cmd-input-line"><span class="cmd-prompt">C:\\ADMIN></span><input type="text" id="cmd-input" autocomplete="off" spellcheck="false" autofocus></div>
                ${q.hint ? `<div style="margin-top:10px;"><button class="hint-btn" onclick="document.getElementById('pbq-hint-text').style.display='block'">[ >> ACCESS_HINT << ]</button><div id="pbq-hint-text" class="hint-text" style="display:none; color: gold; margin-top:10px;">>> HINT: ${q.hint}</div></div>` : ''}
            `;
            document.getElementById('cmd-input').addEventListener("keypress", function(event) { if (event.key === "Enter") submitPBQ(); });
            setTimeout(() => document.getElementById('cmd-input').focus(), 100);
        } else if (q.type === 'match') {
            matchState = { selected: null, pairsFound: 0 };
            let rights = []; q.pairs.forEach((p, i) => { rights.push({ txt: p.right, id: i }); });
            for (let k = rights.length - 1; k > 0; k--) { const j = Math.floor(Math.random() * (k + 1)); [rights[k], rights[j]] = [rights[j], rights[k]]; }
            
            let html = `<div class="match-container"><div class="match-col" id="col-left"></div><div class="match-col" id="col-right"></div></div>`;
            container.innerHTML = html;
            
            q.pairs.forEach((p, i) => {
                let div = document.createElement('div'); div.className = 'match-item'; div.innerText = p.left; div.dataset.id = i; div.dataset.side = 'left';
                div.onclick = (e) => handleMatchClick(e.target); document.getElementById('col-left').appendChild(div);
            });
            rights.forEach(item => {
                let div = document.createElement('div'); div.className = 'match-item'; div.innerText = item.txt; div.dataset.id = item.id; div.dataset.side = 'right';
                div.onclick = (e) => handleMatchClick(e.target); document.getElementById('col-right').appendChild(div);
            });
        }
    }

    function handleMatchClick(el) {
        if (el.classList.contains('matched')) return;
        if (el.classList.contains('selected')) { el.classList.remove('selected'); matchState.selected = null; return; }
        if (!matchState.selected) {
            document.querySelectorAll('.match-item').forEach(b => b.classList.remove('selected'));
            el.classList.add('selected'); matchState.selected = el;
        } else {
            const first = matchState.selected; const second = el;
            if (first.dataset.side === second.dataset.side) { first.classList.remove('selected'); second.classList.add('selected'); matchState.selected = second; return; }
            if (first.dataset.id === second.dataset.id) {
                first.classList.remove('selected'); second.classList.remove('selected');
                first.classList.add('matched'); second.classList.add('matched'); first.style.borderColor = '#0f0'; second.style.borderColor = '#0f0';
                AudioEngine.playSFX('click'); matchState.pairsFound++; matchState.selected = null;
            } else {
                first.classList.remove('selected'); second.classList.add('wrong'); 
                setTimeout(()=> second.classList.remove('wrong'), 400); AudioEngine.playSFX('error');
                integrity -= 3; GameEngine.updateSystemState(); VisualFX.showFloatText("ERR0R", '#f00'); matchState.selected = null;
            }
        }
    }

    function submitPBQ() {
        const q = window.currentQ; let isCorrect = false;
        if (q.type === 'terminal') { if (q.validCommands.includes(document.getElementById('cmd-input').value.trim().toLowerCase())) isCorrect = true; }
        else if (q.type === 'match') { if (matchState.pairsFound === q.pairs.length) isCorrect = true; }
        processResult(isCorrect, document.getElementById('pbq-submit-btn'));
    }

    function processResult(isCorrect, visualElement, allOpts = []) {
        questionsAttempted++;
        const allBtns = document.querySelectorAll('.option-btn'); allBtns.forEach(b => b.disabled = true);
        window.currentQ.tags.forEach(tag => { if (!tagLedger[tag]) tagLedger[tag] = { seen: 0, correct: 0 }; tagLedger[tag].seen++; if(isCorrect) tagLedger[tag].correct++; });
        
        if (isCorrect) {
            if(visualElement) visualElement.classList.add('correct'); 
            currentStreak++; currentScore += 1; questionsCorrect++;
            if (currentStreak > 0 && currentStreak % 3 === 0) { VisualFX.showFloatText("+ INTEGRITY RESTORED", '#0f0'); integrity += 10; AudioEngine.playSFX('healthup'); } 
            else { VisualFX.showFloatText("INPUT ACCEPTED", '#0f0'); integrity += 5; AudioEngine.playSFX('success'); }
        } else {
            if(visualElement) visualElement.classList.add('wrong');
            AudioEngine.playSFX('error'); integrity -= (isExam ? 6 : 19); currentStreak = 0;
            VisualFX.showFloatText("FATAL_ERROR", '#f00');
            const wrap = document.getElementById('integrity-wrap'); wrap.classList.remove('dmg-shock'); void wrap.offsetWidth; wrap.classList.add('dmg-shock');
            if (allOpts.length > 0) allBtns.forEach(b => { if (b.innerText.includes(allOpts.find(o => o.isC).t)) b.classList.add('correct'); });
        }
        
        if (allOpts.length > 0) allBtns.forEach(b => { if (!b.classList.contains('correct') && b !== visualElement) { b.style.display = 'none'; } });
        if (document.getElementById('pbq-submit-btn')) document.getElementById('pbq-submit-btn').style.display = 'none';

        const expBox = document.getElementById('explanation-box');
        VisualFX.typeExplain(expBox, window.currentQ.explanation ? `>> ANALYSIS: ${window.currentQ.explanation}` : ">> ANALYSIS: Data corrupted.");
        
        GameEngine.updateSystemState();
        if (integrity > 0) document.getElementById('next-btn').classList.remove('hidden');
    }

    function nextSeq() { AudioEngine.playSFX('click'); loadSeq(); }

    function finish() {
        switchScreen('quiz-ui', 'results-ui', () => {
            let i = 0; let pct = questionsAttempted > 0 ? Math.floor((questionsCorrect/questionsAttempted)*100) : 0;
            document.getElementById('results-ui').style.display = 'flex';
            const interval = setInterval(() => {
                document.getElementById('final-percent').innerText = `${i}%`;
                if (i % 2 === 0) AudioEngine.playSFX('type'); 
                if (i >= pct) { clearInterval(interval); AudioEngine.playSFX('success'); }
                i++;
            }, 25); 
            generateBreakdown();
        });
    }

    function generateBreakdown() {
        const container = document.getElementById('breakdown-container');
        container.innerHTML = "<div style='margin-bottom:10px; opacity:0.7;'>>> MODULE PERFORMANCE:</div>";
        container.style.display = 'block';
        Object.keys(tagLedger).sort().forEach(tag => {
            if (["CORE1", "CORE2", "NET", "SEC"].includes(tag)) return;
            const data = tagLedger[tag]; const percent = Math.floor((data.correct / data.seen) * 100);
            let barClass = percent >= 90 ? 'bar-green' : (percent >= 70 ? 'bar-yellow' : 'bar-red');
            const row = document.createElement('div'); row.className = 'breakdown-row';
            row.innerHTML = `<div class="bd-tag" title="${tag}">${tag}</div><div class="bd-bar-bg"><div class="bd-bar-fill ${barClass}" style="width: 0%;"></div></div><div class="bd-stat">${percent}%</div>`;
            container.appendChild(row);
            setTimeout(() => { row.querySelector('.bd-bar-fill').style.width = `${percent}%`; }, 100);
        });
    }

    /* =========================================================================
       REGION 6: GLOSSARY & MENU NAVIGATION
       ========================================================================= */
    function toggleGlossary() {
        const ui = document.getElementById('glossary-ui');
        if (ui.classList.contains('hidden')) { ui.classList.remove('hidden'); showExamSelection(); AudioEngine.playSFX('click'); } 
        else { ui.classList.add('hidden'); AudioEngine.playSFX('error'); }
    }

    function showExamSelection() {
        document.getElementById('gloss-select-view').classList.remove('hidden');
        document.getElementById('gloss-content-view').classList.add('hidden');
        document.getElementById('gloss-back-btn').classList.add('hidden');
        document.getElementById('gloss-title').innerText = ">> SELECT_DATABASE";
    }

    function loadGlossaryExam(examKey) {
        currentGlossaryExam = examKey;
        document.getElementById('gloss-select-view').classList.add('hidden');
        document.getElementById('gloss-content-view').classList.remove('hidden');
        document.getElementById('gloss-back-btn').classList.remove('hidden');
        document.getElementById('gloss-title').innerText = `>> DATABASE: ${examKey}`;
        
        const tabContainer = document.getElementById('gloss-tabs'); tabContainer.innerHTML = "";
        const categories = Object.keys(GLOSSARY_DATA[examKey]);
        categories.forEach((cat, index) => {
            const btn = document.createElement('button'); btn.className = 'tab-btn'; btn.innerText = cat;
            btn.onclick = () => renderGlossaryCategory(cat);
            if(index === 0) btn.classList.add('active');
            tabContainer.appendChild(btn);
        });
        if(categories.length > 0) renderGlossaryCategory(categories[0]);
        AudioEngine.playSFX('success');
    }

    function renderGlossaryCategory(category) {
        document.querySelectorAll('.tab-btn').forEach(b => { b.classList.remove('active'); if(b.innerText === category) b.classList.add('active'); });
        const container = document.getElementById('glossary-content'); container.innerHTML = "";
        const data = GLOSSARY_DATA[currentGlossaryExam][category];
        if(data) {
            data.forEach(item => {
                const div = document.createElement('div'); div.className = 'gloss-item';
                div.innerHTML = `<span class="gloss-key">${item.k}</span><span class="gloss-val">${item.v}</span>`;
                div.onclick = () => {
                    let searchTerm = item.k.split('(')[0].trim(); if(searchTerm.includes('/')) searchTerm = searchTerm.split('/')[0].trim();
                    runGlossaryTopic(`${currentGlossaryExam} + ${searchTerm}`);
                };
                container.appendChild(div);
            });
        }
    }

    function runGlossaryTopic(fullQuery) {
        AudioEngine.playSFX('click'); toggleGlossary();
        const searchInput = document.getElementById('topic-search-input');
        if(searchInput) { searchInput.value = fullQuery; }
        setTimeout(() => { startTopicRun(); }, 200);
    }

    function switchScreen(fromId, toId, cb) {
        setTimeout(() => {
            ['root-menu', 'core1-menu', 'core2-menu', 'net-menu', 'sec-menu'].forEach(id => document.getElementById(id).classList.add('hidden'));
            document.getElementById(toId).classList.remove('hidden');
            if(cb) cb();
        }, 250);
    }

    function goToSubMenu(type) {
        let targetId = type === 'core1' ? 'core1-menu' : type === 'core2' ? 'core2-menu' : type === 'net' ? 'net-menu' : 'sec-menu';
        let title = type === 'core1' ? 'CORE 1' : type === 'core2' ? 'CORE 2' : type === 'net' ? 'NETWORK+' : 'SECURITY+';
        VisualFX.scrambleText(document.getElementById('main-header'), `COMPTIA ${title}`);
        document.getElementById('root-menu').classList.add('hidden');
        document.getElementById(targetId).classList.remove('hidden');
        // Re-trigger animations
        document.querySelectorAll(`#${targetId} .btn`).forEach((b, i) => { 
            b.classList.remove('visible'); b.classList.remove('drift-active');
            setTimeout(() => { b.classList.add('visible'); setTimeout(() => b.classList.add('drift-active'), 500); }, 100 + (i * 100)); 
        });
    }

    function goToRoot() {
        ['core1-menu', 'core2-menu', 'net-menu', 'sec-menu'].forEach(id => document.getElementById(id).classList.add('hidden'));
        VisualFX.scrambleText(document.getElementById('main-header'), `COMPTIA SIMULATOR`);
        document.getElementById('root-menu').classList.remove('hidden');
        document.querySelectorAll(`#root-menu .btn`).forEach((b, i) => { 
            b.classList.remove('visible'); b.classList.remove('drift-active');
            setTimeout(() => { b.classList.add('visible'); setTimeout(() => b.classList.add('drift-active'), 500); }, 100 + (i * 100)); 
        });
    }

    function shutdownSystem() {
        AudioEngine.playSFX('error'); 
        const term = document.getElementById('term-win');
        term.classList.remove('power-on');
        setTimeout(() => { location.reload(); }, 600);
    }

    window.onload = function() { GameEngine.bootSystem(); };
</script>
</body>
</html>
