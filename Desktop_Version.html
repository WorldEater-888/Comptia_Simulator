<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYSTEM_ROOT_V18_DASHBOARD</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Dynamic Variables */
            --term-color: #0affba; /* Neon Mint Default */
            --term-dim: rgba(10, 255, 186, 0.2); 
            --split-1: #ff0000; 
            --split-2: #00ffff;
            --glow-color: rgba(10, 255, 186, 0.5);
            --hint-color: #ffd700; 
            
            --edge-opacity: 0;
            --shake-amp: 0px; 
            --glitch-amp: 1px;
            --sway-speed: 5s; 
        }

        /* --- GLOBAL & CURSOR --- */
        html, body, * { cursor: none !important; }

        #custom-cursor {
            position: fixed; top: 0; left: 0; width: 20px; height: 20px;
            border: 2px solid var(--term-color); 
            background-color: rgba(10, 255, 186, 0.1);
            box-shadow: 0 0 10px var(--term-color);
            z-index: 9999; pointer-events: none;
            transform: translate(-50%, -50%); transition: width 0.1s, height 0.1s; mix-blend-mode: screen;
        }
        
        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        ::-webkit-scrollbar { width: 10px; background: #000; }
        ::-webkit-scrollbar-thumb { background: var(--term-color); border: 1px solid #000; }
        ::-webkit-scrollbar-track { background: rgba(0, 20, 20, 0.5); border-left: 1px solid var(--term-color); }

        body {
            background-color: #000000; margin: 0; padding: 40px; 
            font-family: 'VT323', monospace; color: var(--term-color);
            height: 100vh; display: flex; justify-content: center; align-items: center;
            text-shadow: 0 0 4px var(--glow-color); 
            overflow: hidden;
            animation: ghost-sway var(--sway-speed) ease-in-out infinite alternate;
            transition: color 0.4s ease, text-shadow 0.4s ease; 
        }

        /* --- BACKGROUND FX --- */
        .scan-line { position: fixed; left: 0; width: 100%; background: var(--term-color); opacity: 0.3; z-index: 600; pointer-events: none; box-shadow: 0 0 10px var(--term-color); }
        @keyframes scan-drop { 0% { top: -10%; opacity: 0; } 10% { opacity: 0.4; } 100% { top: 110%; opacity: 0; } }

        .pixel-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 900; background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px); }
        #matrix-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; opacity: 0.2; }
        .retro-grid {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 45vh; z-index: -3;
            background: linear-gradient(transparent 0%, rgba(0, 255, 128, 0.1) 2%, transparent 3%), linear-gradient(90deg, transparent 0%, rgba(0, 255, 128, 0.1) 2%, transparent 3%);
            background-size: 50px 50px; transform: perspective(600px) rotateX(70deg) scale(2);
            opacity: 0.5; animation: grid-move 10s linear infinite;
        }

        #panic-pulse {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 850;
            box-shadow: inset 0 0 150px #ff0000; opacity: var(--edge-opacity); mix-blend-mode: overlay;
            animation: pulse-breath-erratic 4s infinite; 
        }

        /* --- TERMINAL WINDOW --- */
        .terminal-window {
            width: 100%; max-width: 1100px; height: 100%; max-height: 92vh;
            border: 3px solid var(--term-color); 
            background: rgba(0, 5, 5, 0.85); 
            backdrop-filter: blur(12px); 
            padding: 25px;
            display: none; flex-direction: column; position: relative;
            box-shadow: 10px 10px 0px rgba(0, 20, 20, 0.6), inset 0 0 40px rgba(0,0,0,0.8);
            z-index: 100; overflow: hidden;
            transition: border-color 0.2s ease;
        }
        .power-on { display: flex !important; animation: turnOn 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards; }

        /* --- HEADER --- */
        .header { 
            border-bottom: 2px solid var(--term-color); padding-bottom: 15px; margin-bottom: 20px; 
            display: flex; flex-direction: column; gap: 10px; flex-shrink: 0;
        }
        .header-top { display: flex; justify-content: space-between; align-items: flex-start; }
        .h-left h1 { 
            margin: 0; font-size: 4rem; letter-spacing: 5px; line-height: 0.8;
            text-shadow: 3px 0 var(--split-1), -3px 0 var(--split-2);
        }
        .status-container { margin-top: 5px; display:flex; gap: 20px; font-size: 1.2rem; opacity: 0.8; }

        /* BUTTONS */
        .donate-group { display: flex; gap: 10px; }
        .sys-btn {
            background: #000; color: var(--term-color);
            font-family: 'VT323', monospace; font-size: 1.1rem; font-weight: bold;
            cursor: pointer; padding: 6px 15px; border: 1px solid var(--term-color);
            box-shadow: 3px 3px 0px rgba(0,0,0,0.5); transition: 0.2s; text-transform: uppercase;
        }
        .sys-btn:hover { transform: translate(-2px, -2px); box-shadow: 6px 6px 0px rgba(0,0,0,0.8); background: var(--term-color); color: #000; }
        
        .kofi-btn { color: #ffd700; border-color: #ffd700; }
        .kofi-btn:hover { background: #ffd700; color: #000; }
        .bmc-btn { color: #FF813F; border-color: #FF813F; }
        .bmc-btn:hover { background: #FF813F; color: #000; }
        .kas-btn { color: #70c7ba; border-color: #70c7ba; }
        .kas-btn:hover { background: #70c7ba; color: #000; }

        /* --- NEW DASHBOARD LAYOUT (THEMATIC REARRANGEMENT) --- */
        .sys-dashboard {
            display: grid; 
            grid-template-columns: 2fr 1fr 2fr; /* Left (HP), Middle (Stats), Right (Temp) */
            gap: 20px; align-items: end; margin-top: 10px;
            padding: 10px; border: 1px dashed var(--term-dim); background: rgba(0,0,0,0.3);
        }

        .dash-module { display: flex; flex-direction: column; gap: 5px; }
        .dash-label { font-size: 1rem; letter-spacing: 2px; font-weight: bold; text-transform: uppercase; display: flex; justify-content: space-between; }
        
        /* CHUNKY BARS */
        .gauge-container {
            width: 100%; height: 40px; /* BIGGER */
            border: 2px solid var(--term-color); background: #000;
            position: relative; padding: 3px;
            box-shadow: inset 0 0 15px rgba(0,255,186,0.2);
        }
        
        /* RULER LINES INSIDE BAR */
        .gauge-container::after {
            content: " "; position: absolute; top:0; left:0; width: 100%; height: 100%; pointer-events: none;
            background: repeating-linear-gradient(90deg, transparent, transparent 19px, rgba(255,255,255,0.1) 20px);
            z-index: 5;
        }

        .gauge-fill {
            height: 100%; background: var(--term-color); width: 100%;
            box-shadow: 0 0 15px var(--term-color); position: relative; z-index: 2;
            transition: width 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94), background-color 0.2s ease;
        }

        /* --- TEMP SPECIFIC --- */
        /* KEY: width 1s linear makes the count-up look like a smooth analog needle */
        #temp-bar { width: 0%; transition: width 1s linear, background-color 0.2s ease, box-shadow 0.2s ease; }

        /* THE MOBILE STROBE EFFECT (Restored) */
        @keyframes temp-strobe {
            0% { background-color: #ff0000; box-shadow: 0 0 20px #ff0000; }
            50% { background-color: #ffffff; box-shadow: 0 0 40px #ffffff; }
            100% { background-color: #ff0000; box-shadow: 0 0 20px #ff0000; }
        }
        .strobe-active { animation: temp-strobe 0.15s infinite !important; }

        /* --- CONTROL CLUSTER (CENTER) --- */
        .ctrl-cluster { 
            text-align: center; display: flex; flex-direction: column; justify-content: flex-end; height: 100%; 
            border-left: 1px solid var(--term-dim); border-right: 1px solid var(--term-dim);
        }
        .score-display { font-size: 2.2rem; font-weight: bold; line-height: 1; margin-bottom: 5px; }
        
        /* --- MENUS & BUTTONS --- */
        .menu-grid { display: grid; grid-template-columns: 1fr; gap: 10px; overflow-y: auto; padding: 10px; }
        .btn { 
            background: rgba(0,0,0,0.6); border: 2px solid var(--term-color); color: var(--term-color); 
            font-family: 'VT323', monospace; font-size: 1.5rem; padding: 12px 20px; 
            cursor: pointer; text-align: left; transition: 0.1s; position: relative; overflow: hidden;
            box-shadow: 5px 5px 0px rgba(0,0,0,0.5); opacity: 0; transform: translateY(10px);
        }
        .btn.visible { opacity: 1 !important; transform: translateY(0) !important; transition: opacity 0.5s ease, transform 0.5s ease; }
        .btn:hover { background: #fff; color: #000; box-shadow: 0 0 30px #fff; border-color: #fff; transform: translate(-2px, -2px) !important; z-index: 10; }
        .btn.drift-active { animation: random-drift 6s ease-in-out infinite alternate; }

        .btn.exam-mode { border-color: #ff4444; color: #ff4444; }
        .btn.exam-mode:hover { background: #ff4444; color: white; box-shadow: 0 0 50px #ff4444; }

        /* --- QUIZ UI --- */
        .quiz-container { display: flex; flex-direction: column; flex-grow: 1; overflow-y: auto; padding-right: 10px; margin-top: 10px; }
        .quiz-header-bar {
            display:flex; justify-content:space-between; align-items:center; 
            border-bottom: 1px solid var(--term-color); padding-bottom: 10px; margin-bottom: 20px; font-size: 1.4rem;
        }
        .question-box { 
            font-size: 1.8rem; line-height: 1.3; margin-bottom: 25px; padding: 15px;
            border-left: 10px solid var(--term-color); background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent);
            text-shadow: 1px 1px 0 #000; color: #fff;
        }
        
        .option-btn { 
            background: rgba(0, 0, 0, 0.7); border: 2px solid var(--term-color); color: #fff; padding: 15px; 
            font-family: inherit; font-size: 1.5rem; text-align: left; cursor: pointer; margin-bottom: 12px;
            transition: 0.1s; position: relative; box-shadow: 5px 5px 0px rgba(0,0,0,0.5);
        }
        .option-btn:hover { background: #fff; color: #000; border-color: #fff; box-shadow: 0 0 30px #fff; transform: translate(-2px, -2px); }
        .option-btn.correct { background: var(--term-color) !important; color: #000 !important; border-color: #fff; box-shadow: 0 0 80px var(--term-color); }
        .option-btn.wrong { background: #a00 !important; color: #fff !important; border-color: #f00; box-shadow: 0 0 80px #f00; animation: answer-shake 0.4s; }

        /* --- FOOTER --- */
        .hacker-footer {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 30px;
            background: rgba(0,0,0,0.8); border-top: 1px solid var(--term-dim);
            display: flex; align-items: center; z-index: 1000;
        }
        .ticker-content { white-space: nowrap; font-size: 0.9rem; color: var(--term-dim); animation: ticker-scroll 120s linear infinite; padding-left: 100%; }
        @keyframes ticker-scroll { 100% { transform: translateX(-100%); } }

        /* --- ANIMATIONS --- */
        @keyframes turnOn { 0% { transform: scaleY(0.005) scaleX(0); opacity: 0; filter: brightness(4); } 60% { transform: scaleY(0.005) scaleX(1); opacity: 1; filter: brightness(2); } 100% { transform: scaleY(1) scaleX(1); opacity: 1; filter: brightness(1); } }
        @keyframes answer-shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
        @keyframes random-drift { 0% { transform: translate(0, 0); } 100% { transform: translate(2px, 1px); } }
        @keyframes ghost-sway { 0% { transform: translate(0, 0) rotate(0deg); } 100% { transform: translate(-1px, 0) rotate(-0.02deg); } }
        @keyframes label-flash { 0%, 100% { color: #ff0000; text-shadow: 0 0 5px #ff0000; } 50% { color: #fff; text-shadow: 0 0 2px #fff; } }
        .label-crit { animation: label-flash 0.2s infinite; }
        .integrity-critical { animation: label-flash 0.5s infinite; border-color: #ff0000; }
        
        /* Utility */
        .hidden { display: none !important; }
        #start-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: #000; z-index: 2000; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; }
        .logo-glitch { animation: slice-glitch 0.3s both infinite; }
        @keyframes slice-glitch { 0% { transform: translate(0); } 20% { transform: translate(-5px, 2px); } 40% { transform: translate(5px, -2px); } 100% { transform: translate(0); } }
        .float-text { position: absolute; font-weight: bold; font-size: 2rem; pointer-events: none; animation: floatUp 2s forwards; z-index: 2000; }
        @keyframes floatUp { 100% { opacity: 0; transform: translateY(-50px) scale(1.2); } }
    </style>
</head>
<body class="glitch-active">

<div id="custom-cursor"></div>
<div class="pixel-overlay"></div>
<canvas id="matrix-canvas"></canvas>
<div class="retro-grid"></div>
<div id="panic-pulse"></div> 
<div id="scan-container"></div> 

<div id="start-overlay" onclick="bootSystem()">
    <div style="font-size: 5rem; color: #fff; letter-spacing: 10px; text-shadow: 5px 0 var(--split-1), -5px 0 var(--split-2); margin-bottom: 50px;" class="logo-glitch">[ SYSTEM_ROOT ]</div>
    <div style="font-size: 2rem; color: var(--term-color); animation: label-flash 2s infinite;">>> INITIALIZE_DESKTOP_ENVIRONMENT <<</div>
</div>

<div class="terminal-window" id="term-win">
    
    <div class="header">
        <div class="header-top">
            <div class="h-left">
                <h1 id="main-header">SYSTEM <span style="font-size: 0.6em; color:#fff;">ROOT</span></h1>
                <div class="status-container">
                    <div id="status-text-1">> STATUS: WAITING...</div>
                    <div id="status-text-2">> NET: IDLE</div>
                </div>
            </div>
            
            <div class="donate-group">
                <button class="sys-btn kofi-btn" onclick="AudioEngine.playMenuHover(); window.open('https://ko-fi.com/worldeater888', '_blank')">[ SUPPORT ]</button>
                <button class="sys-btn bmc-btn" onclick="AudioEngine.playMenuHover(); window.open('https://buymeacoffee.com', '_blank')">[ COFFEE ]</button>
                <button class="sys-btn kas-btn" onclick="AudioEngine.playMenuHover(); showCrypto()">[ KASPA ]</button>
            </div>
        </div>

        <div class="sys-dashboard">
            <div class="dash-module">
                <div class="dash-label">
                    <span>CORE_INTEGRITY</span>
                    <span id="integrity-pct">100%</span>
                </div>
                <div class="gauge-container" id="integrity-cont">
                    <div class="gauge-fill" id="integrity-bar" style="width: 100%;"></div>
                </div>
            </div>

            <div class="dash-module ctrl-cluster">
                <div class="score-display" id="score-ui">PTS: 0</div>
                <button id="sound-toggle" class="sys-btn" style="font-size:0.8rem; padding: 2px;" onclick="AudioEngine.toggleMute()">[ AUDIO: ON ]</button>
            </div>

            <div class="dash-module">
                <div class="dash-label">
                    <span id="temp-label">SYS_TEMP</span>
                    <span id="temp-val">0°C</span>
                </div>
                <div class="gauge-container" style="border-color: #fff;">
                    <div class="gauge-fill" id="temp-bar"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="root-menu">
        <p style="font-size: 1.5rem; border-bottom: 2px dashed var(--term-color); padding-bottom: 10px;">> SELECT_CERTIFICATION_MODULE:</p>
        <div class="menu-grid">
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="goToSubMenu('core1')">[1] COMPTIA A+ CORE 1 <span style="float:right">>></span></button>
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="goToSubMenu('core2')">[2] COMPTIA A+ CORE 2 <span style="float:right">>></span></button>
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="goToSubMenu('net')">[3] NETWORK+ <span style="float:right">>></span></button>
            <button class="btn" onmouseenter="AudioEngine.playMenuHover()" onclick="goToSubMenu('sec')">[4] SECURITY+ <span style="float:right">>></span></button>
        </div>
    </div>

    <div id="core1-menu" class="hidden">
        <p style="font-size: 1.4rem; border-bottom: 1px dashed var(--term-color);">> CORE_1 // MODULES:</p>
        <div class="menu-grid">
            <button class="btn" onclick="transitionToQuiz('CORE1', 'Mobile')">[A] MOBILE_DEVICES</button>
            <button class="btn" onclick="transitionToQuiz('CORE1', 'Networking')">[B] NETWORKING</button>
            <button class="btn" onclick="transitionToQuiz('CORE1', 'Hardware')">[C] HARDWARE</button>
            <button class="btn" onclick="transitionToQuiz('CORE1', 'Cloud')">[D] VIRTUALIZATION</button>
            <button class="btn" onclick="transitionToQuiz('CORE1', 'Troubleshoot')">[E] TROUBLESHOOTING</button>
            <button class="btn exam-mode" onclick="startExam('CORE1')">[X] EXAM_SIMULATION</button>
            <button class="btn" style="border-color:#666; color:#888;" onclick="goToRoot()">< BACK</button>
        </div>
    </div>
    
    <div id="core2-menu" class="hidden">
        <div class="menu-grid">
            <button class="btn" onclick="transitionToQuiz('CORE2', 'OS')">[A] OS_CONCEPTS</button>
            <button class="btn" onclick="transitionToQuiz('CORE2', 'Security')">[B] SECURITY</button>
            <button class="btn" onclick="transitionToQuiz('CORE2', 'Software')">[C] SOFTWARE</button>
            <button class="btn" onclick="transitionToQuiz('CORE2', 'Ops')">[D] PROCEDURES</button>
            <button class="btn exam-mode" onclick="startExam('CORE2')">[X] EXAM_SIMULATION</button>
            <button class="btn" style="border-color:#666; color:#888;" onclick="goToRoot()">< BACK</button>
        </div>
    </div>

    <div id="net-menu" class="hidden">
        <div class="menu-grid">
            <button class="btn" onclick="transitionToQuiz('NET', 'Fundamentals')">[A] FUNDAMENTALS</button>
            <button class="btn" onclick="transitionToQuiz('NET', 'Implement')">[B] IMPLEMENTATION</button>
            <button class="btn" onclick="transitionToQuiz('NET', 'Ops')">[C] OPERATIONS</button>
            <button class="btn" onclick="transitionToQuiz('NET', 'Security')">[D] SECURITY</button>
            <button class="btn" onclick="transitionToQuiz('NET', 'Troubleshoot')">[E] TROUBLESHOOTING</button>
            <button class="btn exam-mode" onclick="startExam('NET')">[X] EXAM_SIMULATION</button>
            <button class="btn" style="border-color:#666; color:#888;" onclick="goToRoot()">< BACK</button>
        </div>
    </div>

    <div id="sec-menu" class="hidden">
        <div class="menu-grid">
            <button class="btn" onclick="transitionToQuiz('SEC', 'Concepts')">[A] CONCEPTS</button>
            <button class="btn" onclick="transitionToQuiz('SEC', 'Threats')">[B] THREATS</button>
            <button class="btn" onclick="transitionToQuiz('SEC', 'Arch')">[C] ARCHITECTURE</button>
            <button class="btn" onclick="transitionToQuiz('SEC', 'Ops')">[D] OPS</button>
            <button class="btn" onclick="transitionToQuiz('SEC', 'Mgmt')">[E] GOVERNANCE</button>
            <button class="btn exam-mode" onclick="startExam('SEC')">[X] EXAM_SIMULATION</button>
            <button class="btn" style="border-color:#666; color:#888;" onclick="goToRoot()">< BACK</button>
        </div>
    </div>

    <div id="quiz-ui" class="hidden quiz-container">
        <div class="quiz-header-bar">
            <span onclick="shutdownSystem()" style="cursor:pointer; font-weight:bold; color:#fff;" class="abort-btn">< ABORT</span>
            <span>TIME: <span id="session-timer" style="color:#fff;">90:00</span></span>
            <span>PKT: <span id="packet-counter" style="color:#fff;">00</span></span>
        </div>
        
        <div class="question-box"><span id="q-text"></span></div>
        <div id="explanation-box" style="margin-bottom:20px; padding:15px; border:2px dashed #fff; display:none; font-size:1.4rem; color:#fff;"></div>
        <div class="options-list" id="opts-list"></div>
        <div id="pbq-area" style="display:none; flex-direction:column; gap:15px; width:100%;"></div>
        <button id="pbq-submit-btn" onclick="submitPBQ()" class="sys-btn" style="width:100%; font-size:1.5rem; margin-top:20px; display:none;">[ EXECUTE ]</button>
        <button class="btn hidden" id="next-btn" onclick="nextSeq()" style="margin-top:20px; width:100%;">>> NEXT_PACKET >></button>
    </div>

    <div id="results-ui" class="hidden" style="text-align: center;">
        <h1 style="font-size: 6rem; margin: 0;" id="final-percent">0%</h1>
        <p style="font-size: 2rem;">> DIAGNOSTIC COMPLETE</p>
        <div id="breakdown-container" style="text-align:left; margin-top:20px;"></div>
        <button class="btn" style="margin-top:40px; width:100%;" onclick="location.reload()">>> REBOOT_SYSTEM</button>
    </div>
    
    <div id="fail-ui" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:5000; flex-direction:column; justify-content:center; align-items:center;">
        <h1 style="font-size:8rem; color:red; text-shadow:5px 0 #fff;" class="logo-glitch">FATAL ERROR</h1>
        <button class="btn" style="border-color:red; color:red;" onclick="location.reload()">>> EMERGENCY RESET</button>
    </div>

</div>

<div class="hacker-footer">
    <div class="ticker-content">
        >> SYS_LOG_START [0x1A4F] >> INITIATING_CORE_DUMP... COMPTIA_SIMULATOR_DESKTOP_EDITION_V18... LOADED_MODULES: CORE1, CORE2, NET+, SEC+... ALL_SYSTEMS_NOMINAL... WAITING_FOR_INPUT...
    </div>
</div>

<script>
    /* === GLOBAL CONFIG === */
    const EXAM_WEIGHTS = {
        'CORE1': [{ tag: 'Mobile', pct: 0.14 }, { tag: 'Networking', pct: 0.20 }, { tag: 'Hardware', pct: 0.27 }, { tag: 'Cloud', pct: 0.11 }, { tag: 'Troubleshoot', pct: 0.28 }],
        'CORE2': [{ tag: 'OS', pct: 0.27 }, { tag: 'Security', pct: 0.24 }, { tag: 'Software', pct: 0.26 }, { tag: 'Ops', pct: 0.23 }],
        'NET': [{ tag: 'Fundamentals', pct: 0.23 }, { tag: 'Implement', pct: 0.18 }, { tag: 'Ops', pct: 0.16 }, { tag: 'Security', pct: 0.20 }, { tag: 'Troubleshoot', pct: 0.23 }],
        'SEC': [{ tag: 'Concepts', pct: 0.12 }, { tag: 'Threats', pct: 0.22 }, { tag: 'Arch', pct: 0.18 }, { tag: 'Ops', pct: 0.28 }, { tag: 'Mgmt', pct: 0.20 }]
    };

    let qQueue = []; let currentScore = 0; let integrity = 100; let tempLevel = 0; const TEMP_MAX = 60;
    let isDead = false; let isExam = false; let quizHistory = [];
    let hudInterval = null; let sessionTime = 5400; let questionsAttempted = 0; let questionsCorrect = 0;

    /* === AUDIO ENGINE === */
    const AudioEngine = {
        ctx: null, masterGain: null, isMuted: false,
        init: function() {
            const AC = window.AudioContext || window.webkitAudioContext;
            this.ctx = new AC(); this.masterGain = this.ctx.createGain(); this.masterGain.gain.value = 0.3;
            this.masterGain.connect(this.ctx.destination);
            if(this.ctx.state === 'suspended') this.ctx.resume();
        },
        playSFX: function(type) {
            if(!this.ctx || this.isMuted) return;
            const t = this.ctx.currentTime;
            const osc = this.ctx.createOscillator(); const g = this.ctx.createGain();
            osc.connect(g); g.connect(this.masterGain);
            if(type==='click') { osc.type='square'; osc.frequency.setValueAtTime(600, t); g.gain.setValueAtTime(0.05, t); g.gain.exponentialRampToValueAtTime(0.01, t+0.05); osc.start(t); osc.stop(t+0.05); }
            if(type==='error') { osc.type='sawtooth'; osc.frequency.setValueAtTime(100, t); osc.frequency.linearRampToValueAtTime(50, t+0.3); g.gain.setValueAtTime(0.1, t); g.gain.linearRampToValueAtTime(0, t+0.3); osc.start(t); osc.stop(t+0.3); }
            if(type==='success') { osc.type='sine'; osc.frequency.setValueAtTime(800, t); osc.frequency.exponentialRampToValueAtTime(1200, t+0.2); g.gain.setValueAtTime(0.1, t); g.gain.linearRampToValueAtTime(0, t+0.2); osc.start(t); osc.stop(t+0.2); }
        },
        playMenuHover: function() { if(!this.ctx || this.isMuted) return; const t=this.ctx.currentTime; const o=this.ctx.createOscillator(); const g=this.ctx.createGain(); o.connect(g); g.connect(this.masterGain); o.frequency.setValueAtTime(400,t); g.gain.setValueAtTime(0.01,t); g.gain.linearRampToValueAtTime(0,t+0.05); o.start(t); o.stop(t+0.05); },
        toggleMute: function() { this.isMuted = !this.isMuted; document.getElementById('sound-toggle').innerText = this.isMuted ? "[ AUDIO: OFF ]" : "[ AUDIO: ON ]"; }
    };

    /* === SYSTEM CORE === */
    function bootSystem() {
        document.getElementById('start-overlay').style.display = 'none';
        document.getElementById('term-win').style.display = 'flex';
        document.getElementById('term-win').classList.add('power-on');
        AudioEngine.init();
        spawnMatrix(); spawnScanlines();
        const rootBtns = document.querySelectorAll('#root-menu .btn');
        rootBtns.forEach((b,i) => setTimeout(() => { b.classList.add('visible'); b.classList.add('drift-active'); }, i*100));
    }

    function startHUD() {
        if(hudInterval) clearInterval(hudInterval);
        hudInterval = setInterval(() => {
            if(isDead) return;
            if(sessionTime > 0) sessionTime--;
            let m = Math.floor(sessionTime/60); let s = sessionTime%60;
            document.getElementById('session-timer').innerText = `${m}:${s.toString().padStart(2,'0')}`;
            
            // TEMP LOGIC: COUNTS UP 1 PER SECOND
            if(document.getElementById('next-btn').classList.contains('hidden')) {
                if(tempLevel < TEMP_MAX) tempLevel++;
                updateTempVisuals();
            }
        }, 1000);
    }

    function updateTempVisuals() {
        const bar = document.getElementById('temp-bar');
        const label = document.getElementById('temp-label');
        const val = document.getElementById('temp-val');
        const pct = tempLevel / TEMP_MAX;
        
        // SMOOTH WIDTH UPDATE (via CSS transition)
        bar.style.width = `${pct * 100}%`;
        val.innerText = `${tempLevel * 2}°C`; // Fake C value
        
        bar.classList.remove('strobe-active');
        label.classList.remove('label-crit');

        if(tempLevel >= 50) {
            // OVERHEAT
            bar.style.backgroundColor = '#ff0000';
            bar.classList.add('strobe-active'); // TRIGGER THE FLASH
            label.innerText = "!! CRITICAL !!";
            label.style.color = "red";
            label.classList.add('label-crit');
        } else if(tempLevel >= 40) {
            bar.style.backgroundColor = '#ff4400';
            label.innerText = ">> DANGER <<";
            label.style.color = "orange";
        } else if (tempLevel >= 20) {
            bar.style.backgroundColor = '#ffff00';
            label.innerText = "WARMING...";
            label.style.color = "yellow";
        } else {
            bar.style.backgroundColor = '#0affba';
            label.innerText = "SYS_TEMP";
            label.style.color = "#0affba";
        }
    }

    function resetTemp() { tempLevel = 0; updateTempVisuals(); }

    function updateIntegrity() {
        if(integrity < 0) integrity = 0; if(integrity > 100) integrity = 100;
        const bar = document.getElementById('integrity-bar');
        const txt = document.getElementById('integrity-pct');
        const cont = document.getElementById('integrity-cont');
        
        bar.style.width = `${integrity}%`;
        txt.innerText = `${integrity}%`;
        
        if(integrity < 30) { 
            cont.classList.add('integrity-critical'); 
            bar.style.backgroundColor = "red";
        } else {
            cont.classList.remove('integrity-critical');
            bar.style.backgroundColor = "#0affba";
        }

        if(integrity <= 0 && !isDead) {
            isDead = true; 
            document.getElementById('fail-ui').style.display = 'flex';
        }
    }

    /* === QUIZ & NAVIGATION === */
    const MASTER_DATABASE = [
        { tags: ["CORE1", "Hardware"], question: "A technician installs 16GB RAM, but Windows reports 4GB usable. Why?", options: ["OS is 32-bit (x86)", "RAM is unseated", "BIOS outdated", "Motherboard limitation"], answer: 0, explanation: "32-bit operating systems have a hard memory address limit of 4GB." },
        { tags: ["CORE1", "Networking"], question: "Which port does SSH use?", options: ["21", "22", "23", "80"], answer: 1, explanation: "SSH uses port 22." },
        { tags: ["NET", "Ops"], question: "You need to trace the route to a host. Which command?", options: ["ping", "tracert", "ipconfig", "nslookup"], answer: 1, explanation: "tracert (Windows) traces the path." }
    ];

    function fetchQuestions(tags) { return MASTER_DATABASE.filter(q => tags.every(t => q.tags.includes(t))); }

    function goToSubMenu(id) {
        document.getElementById('root-menu').classList.add('hidden');
        const m = document.getElementById(id + '-menu'); m.classList.remove('hidden');
        m.querySelectorAll('.btn').forEach((b,i) => setTimeout(() => { b.classList.add('visible'); }, i*50));
    }
    
    function goToRoot() {
        document.querySelectorAll('[id$="-menu"]').forEach(e => e.classList.add('hidden'));
        document.getElementById('root-menu').classList.remove('hidden');
    }

    function transitionToQuiz(cert, mod) {
        qQueue = fetchQuestions([cert, mod]);
        startQuiz();
    }

    function startExam(cert) {
        // Simple mock for logic - in production use the weighting logic from previous step
        qQueue = fetchQuestions([cert]); 
        // Duplicate to fake length
        while(qQueue.length < 10) qQueue = qQueue.concat(qQueue);
        startQuiz();
    }

    function startQuiz() {
        document.querySelectorAll('[id$="-menu"], #root-menu').forEach(e => e.classList.add('hidden'));
        document.getElementById('quiz-ui').classList.remove('hidden');
        resetTemp(); startHUD(); loadQuestion();
    }

    function loadQuestion() {
        if(qQueue.length === 0) { finishQuiz(); return; }
        window.currentQ = qQueue.pop();
        document.getElementById('packet-counter').innerText = qQueue.length;
        document.getElementById('q-text').innerText = window.currentQ.question;
        
        const opts = document.getElementById('opts-list'); opts.innerHTML = '';
        window.currentQ.options.forEach((o, i) => {
            const b = document.createElement('button'); b.className = 'option-btn'; b.innerText = `> ${o}`;
            b.onclick = () => checkAnswer(i === window.currentQ.answer, b);
            opts.appendChild(b);
        });
        document.getElementById('next-btn').classList.add('hidden');
        document.getElementById('explanation-box').style.display = 'none';
        resetTemp();
    }

    function checkAnswer(isCorrect, btn) {
        questionsAttempted++;
        const all = document.querySelectorAll('.option-btn');
        all.forEach(b => b.style.pointerEvents = 'none');
        
        if(isCorrect) {
            btn.classList.add('correct'); currentScore++; integrity += 5; questionsCorrect++;
            AudioEngine.playSFX('success');
            showFloat("+ INTEGRITY", btn, '#0f0');
        } else {
            btn.classList.add('wrong'); integrity -= 15;
            AudioEngine.playSFX('error');
            showFloat("DAMAGE", btn, '#f00');
        }
        
        document.getElementById('score-ui').innerText = `PTS: ${currentScore}`;
        document.getElementById('explanation-box').style.display = 'block';
        document.getElementById('explanation-box').innerText = ">> " + window.currentQ.explanation;
        document.getElementById('next-btn').classList.remove('hidden');
        
        updateIntegrity();
    }

    function nextSeq() { AudioEngine.playSFX('click'); loadQuestion(); }
    
    function showFloat(txt, el, col) {
        const d = document.createElement('div'); d.className = 'float-text'; 
        d.innerText = txt; d.style.color = col; d.style.textShadow = `0 0 10px ${col}`;
        const r = el.getBoundingClientRect(); d.style.left = r.left + "px"; d.style.top = r.top + "px";
        document.body.appendChild(d); setTimeout(()=>d.remove(), 2000);
    }
    
    function finishQuiz() {
        document.getElementById('quiz-ui').classList.add('hidden');
        document.getElementById('results-ui').classList.remove('hidden');
        document.getElementById('final-percent').innerText = Math.floor((questionsCorrect/questionsAttempted)*100) + "%";
    }

    /* === FLUFF === */
    function spawnMatrix() {
        const c = document.getElementById('matrix-canvas'); const ctx = c.getContext('2d');
        c.width=window.innerWidth; c.height=window.innerHeight;
        const cols = Math.floor(c.width/20); const drops = Array(cols).fill(1);
        setInterval(() => {
            ctx.fillStyle='rgba(0,0,0,0.05)'; ctx.fillRect(0,0,c.width,c.height);
            ctx.fillStyle='#0affba'; ctx.font='15px monospace';
            drops.forEach((y,i) => {
                const txt = String.fromCharCode(0x30A0+Math.random()*96);
                ctx.fillText(txt, i*20, y*20);
                if(y*20 > c.height && Math.random()>0.975) drops[i]=0;
                drops[i]++;
            });
        }, 50);
    }
    function spawnScanlines() {
        setInterval(() => {
            const l = document.createElement('div'); l.className='scan-line'; 
            l.style.height = Math.random()*5+'px'; l.style.animation=`scan-drop ${Math.random()*2+2}s linear`;
            document.getElementById('scan-container').appendChild(l);
            setTimeout(()=>l.remove(), 4000);
        }, 2000);
    }
    
    /* === DONATION === */
    function showCrypto() {
        const addr = "kaspa:qqy08j0lcaunrga9pdq29sputscc8v5hjjyjlge93qye9aexejhxv43sq7tyq";
        alert("COPIED KASPA ADDRESS:\n" + addr);
        navigator.clipboard.writeText(addr);
    }
    function shutdownSystem() { location.reload(); }
</script>
</body>
</html>
