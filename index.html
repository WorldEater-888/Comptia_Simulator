<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SYSTEM_ROOT_FINAL_RESTORED</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Dynamic Variables - Controlled by JS */
            --term-color: #0affba; 
            --split-1: #ff0000; 
            --split-2: #00ffff; 
            --glow-color: rgba(10, 255, 186, 0.6);
            
            --edge-opacity: 0; 
            --pulse-speed: 2s; /* Speed of the panic pulse */
        }

        /* --- GLOBAL RESETS --- */
        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            user-select: none; 
            cursor: auto !important; 
        }
        
        html, body {
            width: 100%;
            overflow-x: hidden; 
        }
        
        body {
            background-color: #000000;
            margin: 0; padding: 0;
            font-family: 'VT323', monospace;
            color: var(--term-color);
            height: 100dvh;
            display: flex;
            flex-direction: column;
            
            /* BASE GLOW ON ALL TEXT */
            text-shadow: 0 0 5px var(--glow-color), 0 0 10px var(--glow-color); 
            box-shadow: inset 0 0 100px rgba(0,0,0,0.9);
            
            /* Slight whole-screen sway */
            animation: ghost-sway 6s ease-in-out infinite alternate;
            transition: color 0.2s ease, text-shadow 0.2s ease; 
        }

        /* --- BACKGROUND LAYERS --- */
        .scan-line {
            position: fixed; left: 0; width: 100%;
            background: var(--term-color); opacity: 0.15; z-index: 600;
            pointer-events: none; box-shadow: 0 0 10px var(--term-color);
        }
        @keyframes scan-drop { 0% { top: -10%; opacity: 0; } 10% { opacity: 0.35; } 100% { top: 110%; opacity: 0; } }

        .pixel-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 900; background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px); }
        
        #matrix-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; opacity: 0.3; }
        
        .retro-grid {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 45vh; z-index: -3;
            background: linear-gradient(transparent 0%, rgba(0, 255, 128, 0.1) 2%, transparent 3%), linear-gradient(90deg, transparent 0%, rgba(0, 255, 128, 0.1) 2%, transparent 3%);
            background-size: 50px 50px;
            transform: perspective(600px) rotateX(70deg) scale(2);
            opacity: 0.5;
            animation: grid-move 10s linear infinite;
        }

        /* Panic Pulse - Outer Edge Glow tied to Integrity */
        #panic-pulse {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 850;
            /* Inset shadow creates the vignette */
            box-shadow: inset 0 0 100px #ff0000, inset 0 0 20px #ff0000; 
            opacity: var(--edge-opacity); 
            mix-blend-mode: hard-light;
            transition: opacity 0.5s ease;
            animation: pulse-breath-erratic var(--pulse-speed) infinite; 
        }

        /* --- TERMINAL WINDOW --- */
        .terminal-window {
            width: 100%; height: 100%;
            border: none;
            background: rgba(0, 5, 5, 0.75); 
            backdrop-filter: blur(3px); -webkit-backdrop-filter: blur(3px);
            padding: 10px;
            display: none; flex-direction: column; position: relative;
            z-index: 100; overflow: hidden;
            /* Base Outer Glow */
            box-shadow: inset 0 0 20px rgba(10, 255, 186, 0.1);
        }
        .power-on { display: flex !important; animation: turnOn 0.8s cubic-bezier(0.23, 1, 0.32, 1) forwards; }

        /* --- HEADER --- */
        .header { 
            border-bottom: 2px solid var(--term-color); 
            padding-bottom: 5px; margin-bottom: 10px; 
            display: flex; flex-direction: column; gap: 5px;
            flex-shrink: 0; position: relative;
            box-shadow: 0 5px 15px -10px var(--term-color); /* Glow under header */
        }
        .header-top { display: flex; justify-content: space-between; align-items: flex-start; width: 100%; }
        
        .h-left h1 { 
            margin: 0; font-size: 2.2rem; letter-spacing: 2px; line-height: 1;
            /* Strong RGB Split on Header */
            text-shadow: 2px 0 var(--split-1), -2px 0 var(--split-2), 0 0 10px var(--term-color);
            font-weight: normal;
        }

        /* Donation Buttons */
        .donate-group { display: flex; gap: 6px; }
        .sys-btn {
            background: rgba(0, 0, 0, 0.8);
            font-family: 'VT323', monospace;
            font-size: 0.9rem; font-weight: bold;
            cursor: pointer; padding: 4px 8px;
            border: 1px solid;
            box-shadow: 0 0 5px currentColor, inset 0 0 5px currentColor; /* Inner/Outer Glow */
            transition: all 0.2s ease;
            text-transform: uppercase;
        }
        .sys-btn:active { transform: translate(1px, 1px); background: var(--term-color); color: #000; }
        .kofi-btn { color: #ffd700; border-color: #ffd700; }
        .kas-btn { color: #70c7ba; border-color: #70c7ba; }

        /* Integrity & Temp Bars */
        .header-stats-row { display: flex; align-items: flex-end; justify-content: space-between; width: 100%; }
        .bars-group { display: flex; flex-direction: column; gap: 4px; width: 65%; }
        .integrity-wrapper { width: 100%; display: flex; align-items: center; gap: 5px; }
        .integrity-label { font-size: 0.8rem; letter-spacing: 1px; font-weight:bold; min-width: 65px; }
        
        .integrity-container { 
            flex-grow: 1; height: 10px; border: 1px solid var(--term-color); 
            background: rgba(0,0,0,0.8); 
            box-shadow: 0 0 5px var(--term-color);
        }
        .integrity-fill { 
            height: 100%; width: 100%; 
            box-shadow: 0 0 15px var(--term-color); 
            transition: width 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94), background 0.2s ease;
            background: repeating-linear-gradient(90deg, var(--term-color), var(--term-color) 4px, transparent 4px, transparent 6px);
            animation: health-pulse 1s infinite alternate;
        }
        
        #temp-bar { transition: width 1s linear !important; }
        
        /* Phosphorus Flash Damage Effect */
        .dmg-shock { animation: phosphorus-flash 0.5s ease-out; }
        @keyframes phosphorus-flash {
            0% { filter: brightness(4) contrast(2); box-shadow: 0 0 50px #fff; }
            30% { filter: brightness(2); box-shadow: 0 0 20px var(--term-color); }
            100% { filter: brightness(1); }
        }

        .audio-btn { 
            font-size: 0.8rem; background: transparent; 
            border: 1px solid var(--term-color); color: inherit; padding: 2px 5px;
            cursor: pointer; position: relative; overflow: hidden;
            box-shadow: 0 0 5px var(--term-color);
        }

        /* --- MENUS & BUTTONS --- */
        .menu-grid { 
            display: grid; grid-template-columns: 1fr; 
            gap: 15px; margin-top: 15px; overflow-y: auto; padding-bottom: 20px;
        }

        .btn { 
            background: rgba(0, 10, 10, 0.4); 
            border: 1px solid var(--term-color); 
            color: var(--term-color); 
            font-family: 'VT323', monospace; 
            font-size: 1.4rem; padding: 12px 15px;
            cursor: pointer; text-align: left; 
            position: relative; overflow: hidden; 
            
            /* MOVEMENT: Subtle Float */
            animation: float-idle 3s ease-in-out infinite;
            
            /* GLOW: Base Glow */
            box-shadow: 0 0 8px rgba(10, 255, 186, 0.2), inset 0 0 10px rgba(10, 255, 186, 0.1);
            text-shadow: 0 0 4px var(--term-color);
            
            opacity: 0; transform: translateY(10px);
        }
        .btn.visible { opacity: 1 !important; transform: translateY(0) !important; transition: opacity 0.4s ease, transform 0.4s ease; }
        
        /* HOVER: Jitter Glitch */
        .btn:hover {
            background: rgba(10, 255, 186, 0.1);
            animation: jitter-glitch 0.2s infinite !important; /* Fast Jitter */
            border-color: #fff;
            color: #fff;
            box-shadow: 0 0 15px var(--term-color);
        }
        
        .btn:active { 
            background: #fff; color: #000; 
            box-shadow: 0 0 30px #fff; border-color: #fff; 
            animation: rgb-split-hover 0.1s infinite !important; 
            transform: translate(-1px, -1px) !important; 
        }
        
        .btn.exam-mode { border-color: #ff4444; color: #ff4444; box-shadow: 0 0 8px rgba(255, 0, 0, 0.3); }

        .nav-btn { 
            position: fixed; bottom: 15px; left: 10px; width: calc(100% - 20px);
            font-weight: bold; text-align: center; 
            background: #000; color: var(--term-color); border: 2px solid var(--term-color); 
            font-family: 'VT323', monospace; font-size: 1.8rem; padding: 15px; 
            box-shadow: 0 0 20px rgba(10, 255, 186, 0.4); z-index: 500; text-transform: uppercase;
            animation: float-idle 4s ease-in-out infinite;
        }
        .nav-btn:active { background: var(--term-color); color: #000; box-shadow: 0 0 50px var(--term-color); }

        /* --- QUIZ AREA --- */
        .quiz-container { 
            display: flex; flex-direction: column; flex-grow: 1; 
            overflow-y: auto; overflow-x: hidden; padding-bottom: 90px;
        }
        .question-box { 
            font-size: 1.6rem; line-height: 1.2; margin-bottom: 20px; 
            background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent);
            border-left: 6px solid var(--term-color); padding: 15px; 
            color: #ffffff !important;
            
            /* GLOW & DRIFT */
            box-shadow: 0 0 15px rgba(10, 255, 186, 0.15);
            text-shadow: 0 0 5px rgba(255,255,255,0.5), 2px 0 var(--split-1);
            animation: random-drift 6s ease-in-out infinite alternate;
        }
        
        .option-btn { 
            background: rgba(0, 0, 0, 0.7); border: 2px solid var(--term-color); 
            color: #ffffff !important; padding: 12px; 
            font-family: 'VT323', monospace; font-size: 1.4rem; text-align: left; 
            cursor: pointer; position: relative; margin-bottom: 10px;
            
            /* Movement & Glow */
            animation: float-idle 3s ease-in-out infinite;
            animation-delay: calc(var(--i) * 0.2s); /* Staggered float */
            box-shadow: 0 0 10px rgba(10, 255, 186, 0.15);
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
        }
        /* Staggered delays set in JS or manually */

        .option-btn:hover {
            animation: jitter-glitch 0.3s infinite !important;
            border-color: #fff;
            box-shadow: 0 0 15px #fff;
        }

        .option-btn.correct { background: var(--term-color) !important; color: black !important; border-color: white; box-shadow: 0 0 50px var(--term-color) !important; animation: answer-thump 0.3s ease-out forwards !important; }
        .option-btn.wrong { background: #a00 !important; color: white !important; border-color: red; box-shadow: 0 0 50px red !important; animation: answer-shake 0.4s ease-in-out forwards !important; }

        /* --- ANIMATIONS (REVISED) --- */
        @keyframes turnOn { 0% { transform: scaleY(0.005) scaleX(0); opacity: 0; filter: brightness(4); } 60% { transform: scaleY(0.005) scaleX(1); opacity: 1; filter: brightness(2); } 100% { transform: scaleY(1) scaleX(1); opacity: 1; filter: brightness(1); } }
        
        /* NEW: Subtle floating for buttons */
        @keyframes float-idle {
            0% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
            100% { transform: translateY(0); }
        }

        /* NEW: Fast Jitter for Glitches */
        @keyframes jitter-glitch {
            0% { transform: translate(0,0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(2px, -2px); }
            60% { transform: translate(-2px, 0); }
            80% { transform: translate(2px, 0); }
            100% { transform: translate(0,0); }
        }

        /* Strong RGB Split */
        @keyframes rgb-split-hover { 
            0% { text-shadow: -3px 0 red, 3px 0 blue; transform: translate(0,0); } 
            25% { text-shadow: 3px 0 red, -3px 0 blue; transform: translate(-3px, 1px); } 
            50% { text-shadow: 0 -3px red, 0 3px blue; transform: translate(3px, -1px); }
            100% { text-shadow: -3px 0 red, 3px 0 blue; transform: translate(0,0); } 
        }
        
        @keyframes pulse-breath-erratic { 
            0% { opacity: var(--edge-opacity); } 
            50% { opacity: calc(var(--edge-opacity) * 0.3); } 
            100% { opacity: var(--edge-opacity); } 
        }

        /* Helpers */
        .logo-glitch { animation: slice-glitch 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) both infinite !important; color: #fff !important; }
        
        /* Enhanced Random Glitch Class */
        .random-glitch-active { 
            animation: rgb-split-hover 0.15s infinite !important; 
            color: #fff !important;
            text-shadow: 4px 0 #ff0000, -4px 0 #0000ff !important;
        }
        
        .integrity-critical { animation: crit-pulse 0.2s infinite !important; background: repeating-linear-gradient(90deg, #ff0000, #ff0000 8px, transparent 8px, transparent 10px) !important; box-shadow: 0 0 25px #ff0000 !important; }
        
        /* --- SCREENS --- */
        #fail-ui { 
            display: none; text-align: center; position: fixed; top: 0; left: 0; width: 100vw; height: 100dvh; 
            z-index: 2000; background: rgba(5, 0, 0, 0.95); 
            flex-direction: column; justify-content: center; align-items: center; 
            opacity: 0; pointer-events: none; padding: 20px; overflow: hidden;
        }
        .fail-visible { display: flex !important; opacity: 1 !important; pointer-events: auto !important; animation: fail-entry 0.3s ease-out forwards; color: #ccffff; }
        .fail-text { font-size: 3rem; word-break: break-word; color:#fff; animation: jitter-glitch 0.1s infinite; text-shadow: 3px 0 red, -3px 0 blue; }
        
        /* PBQ & Other CSS remains largely same but inherits global glows */
        .pbq-wrapper { display: none; width: 100%; flex-direction: column; gap: 15px; }
        .cmd-input-line { display: flex; align-items: center; background: rgba(0,0,0,0.8); border: 1px solid var(--term-color); padding: 10px; font-size: 1.3rem; box-shadow: 0 0 10px var(--term-color); }
        #cmd-input { flex-grow: 1; background: transparent; border: none; color: #fff; font-family: inherit; font-size: inherit; outline: none; }
        .match-item { border: 1px solid var(--term-color); background: rgba(0, 20, 20, 0.6); padding: 10px; text-align: center; font-size: 1.1rem; color: #fff; transition: 0.2s; box-shadow: 0 0 5px var(--term-color); animation: float-idle 4s ease-in-out infinite; }
        .match-item.selected { background: var(--term-color); color: #000; box-shadow: 0 0 25px var(--term-color); animation: jitter-glitch 0.2s infinite; }
        
        .hidden { display: none !important; }

    </style>
</head>
<body class="glitch-active">

<div class="pixel-overlay"></div>
<canvas id="matrix-canvas"></canvas>
<div class="retro-grid"></div>
<div id="panic-pulse"></div> 
<div id="scan-container"></div> 

<div id="start-overlay" onclick="bootSystem()">
    <div style="margin-bottom: 50px; font-size: 3rem; color: #fff; letter-spacing: 5px; text-shadow: 4px 0 var(--split-1), -4px 0 var(--split-2);" class="logo-glitch">
        [ SYSTEM_ROOT ]
    </div>
    <div style="font-size: 1.2rem; color: var(--term-color); text-transform: uppercase; letter-spacing: 3px; animation: blink 3s infinite;">
        >> TAP_TO_INITIALIZE <<
    </div>
    <div style="margin-top: 100px; font-size: 0.8rem; opacity: 0.5; font-family: monospace;">
        MOBILE_CORE_V2.0 // SOUL_RESTORED
    </div>
</div>

<div class="terminal-window" id="term-win">
    
    <div class="header">
        <div class="header-top">
            <div class="h-left">
                <h1 id="main-header">SYSTEM <span style="font-size: 0.6em; color:#fff;">ROOT</span></h1>
            </div>
            <div class="donate-group">
                <button class="sys-btn kofi-btn" onclick="AudioEngine.playMenuHover(); window.open('https://ko-fi.com/worldeater888', '_blank')">[TIPS]</button>
                <button class="sys-btn kas-btn" onclick="AudioEngine.playMenuHover(); showCrypto()">[KAS]</button>
            </div>
        </div>
        
        <div class="header-stats-row">
            <div class="bars-group">
                <div class="integrity-wrapper" id="integrity-wrap">
                    <div class="integrity-label">INTEGRITY</div>
                    <div class="integrity-container">
                        <div class="integrity-fill" id="integrity-bar"></div>
                    </div>
                </div>
                <div class="integrity-wrapper" id="temp-wrap">
                    <div class="integrity-label" id="temp-label" style="color: #fff;">TEMP</div>
                    <div class="integrity-container" style="border: 1px solid #ffffff;">
                        <div class="integrity-fill" id="temp-bar" style="width: 0%; background: #0affba;"></div>
                    </div>
                </div>
            </div>
            <div style="text-align: right;">
                 <div id="score-ui" style="font-weight: bold; font-size: 1.2rem; margin-bottom: 5px;">PTS: 0</div>
                 <button id="sound-toggle" class="audio-btn" onclick="AudioEngine.toggleMute()">[AUDIO:ON]</button>
            </div>
        </div>
    </div>

    <div id="root-menu">
        <p style="font-size: 1.1rem; border-bottom: 1px dashed var(--term-color); padding-bottom: 5px;">> SELECT_CERTIFICATION:</p>
        <div class="menu-grid">
            <button class="btn" onclick="AudioEngine.playMenuHover(); goToSubMenu('core1', 'A+ CORE 1')">[1] COMPTIA A+ CORE 1</button>
            <button class="btn" onclick="AudioEngine.playMenuHover(); goToSubMenu('core2', 'A+ CORE 2')">[2] COMPTIA A+ CORE 2</button>
            <button class="btn" onclick="AudioEngine.playMenuHover(); goToSubMenu('net', 'NETWORK+')">[3] NETWORK+</button>
            <button class="btn" onclick="AudioEngine.playMenuHover(); goToSubMenu('sec', 'SECURITY+')">[4] SECURITY+</button>
        </div>
    </div>

    <div id="core1-menu" class="hidden">
        <p style="font-size: 1.1rem; border-bottom: 1px dashed var(--term-color);">> CORE_1 // MODULES:</p>
        <div class="menu-grid">
            <button class="btn" onclick="AudioEngine.playMenuHover(); transitionToQuiz('CORE1', 'Hardware')">[A] HARDWARE_CORE</button>
            <button class="btn" onclick="AudioEngine.playMenuHover(); transitionToQuiz('CORE1', 'Networking')">[B] NETWORKING</button>
            <button class="btn" onclick="AudioEngine.playMenuHover(); transitionToQuiz('CORE1', 'Mobile')">[C] MOBILE</button>
            <button class="btn" onclick="AudioEngine.playMenuHover(); transitionToQuiz('CORE1', 'Cloud')">[D] CLOUD_OPS</button>
            <button class="btn exam-mode" onclick="AudioEngine.playMenuHover(); startExam('CORE1')">[X] EXAM_SIMULATION</button>
            <button class="btn" style="border-color: #666; color: #888;" onclick="AudioEngine.playMenuHover(); goToRoot()"> < BACK TO ROOT </button>
        </div>
    </div>
    
    <div id="core2-menu" class="hidden">
        <div class="menu-grid">
            <button class="btn" onclick="AudioEngine.playMenuHover(); transitionToQuiz('CORE2', 'OS')">[A] OS_CONCEPTS</button>
            <button class="btn" onclick="AudioEngine.playMenuHover(); transitionToQuiz('CORE2', 'Security')">[B] SECURITY</button>
            <button class="btn" onclick="AudioEngine.playMenuHover(); transitionToQuiz('CORE2', 'Software')">[C] SOFTWARE</button>
            <button class="btn" onclick="AudioEngine.playMenuHover(); transitionToQuiz('CORE2', 'Ops')">[D] OPS_PROCEDURES</button>
            <button class="btn exam-mode" onclick="AudioEngine.playMenuHover(); startExam('CORE2')">[X] EXAM_SIMULATION</button>
            <button class="btn" style="border-color: #666; color: #888;" onclick="AudioEngine.playMenuHover(); goToRoot()"> < BACK </button>
        </div>
    </div>
    <div id="net-menu" class="hidden">
        <div class="menu-grid">
            <button class="btn" onclick="AudioEngine.playMenuHover(); transitionToQuiz('NET', 'Fundamentals')">[A] FUNDAMENTALS</button>
            <button class="btn" onclick="AudioEngine.playMenuHover(); transitionToQuiz('NET', 'Implement')">[B] IMPLEMENTATION</button>
            <button class="btn" onclick="AudioEngine.playMenuHover(); transitionToQuiz('NET', 'Ops')">[C] OPERATIONS</button>
            <button class="btn" onclick="AudioEngine.playMenuHover(); transitionToQuiz('NET', 'Security')">[D] SECURITY</button>
            <button class="btn exam-mode" onclick="AudioEngine.playMenuHover(); startExam('NET')">[X] EXAM_SIMULATION</button>
            <button class="btn" style="border-color: #666; color: #888;" onclick="AudioEngine.playMenuHover(); goToRoot()"> < BACK </button>
        </div>
    </div>
    <div id="sec-menu" class="hidden">
        <div class="menu-grid">
            <button class="btn" onclick="AudioEngine.playMenuHover(); transitionToQuiz('SEC', 'Attacks')">[A] THREATS_ATTACKS</button>
            <button class="btn" onclick="AudioEngine.playMenuHover(); transitionToQuiz('SEC', 'Arch')">[B] ARCHITECTURE</button>
            <button class="btn" onclick="AudioEngine.playMenuHover(); transitionToQuiz('SEC', 'Implement')">[C] IMPLEMENTATION</button>
            <button class="btn" onclick="AudioEngine.playMenuHover(); transitionToQuiz('SEC', 'Gov')">[D] GOVERNANCE</button>
            <button class="btn exam-mode" onclick="AudioEngine.playMenuHover(); startExam('SEC')">[X] EXAM_SIMULATION</button>
            <button class="btn" style="border-color: #666; color: #888;" onclick="AudioEngine.playMenuHover(); goToRoot()"> < BACK </button>
        </div>
    </div>

    <div id="quiz-ui" class="hidden quiz-container">
        <div class="quiz-header-bar">
            <span onclick="shutdownSystem()" style="color:#fff; text-decoration:underline; font-weight:bold; cursor:pointer;">< ABORT</span>
            <span style="opacity:0.8;">[TIME]: <span id="session-timer" style="color:#fff;">90:00</span></span>
            <span style="opacity:0.8;">[PKT]: <span id="packet-counter" style="color:#fff;">00</span></span>
        </div>
        
        <div class="question-box"><span id="q-text"></span></div>
        <div id="explanation-box"></div>
        
        <div class="options-list" id="opts-list"></div>

        <div id="pbq-area" class="pbq-wrapper"></div>
        
        <button id="pbq-submit-btn" class="btn" onclick="submitPBQ()" style="display:none; margin-top:10px;">[ EXECUTE_COMMAND ]</button>
        
        <button class="nav-btn hidden" id="next-btn" onclick="nextSeq()">>> NEXT_PACKET >></button>
    </div>

    <div id="results-ui" class="hidden" style="text-align: center; padding-top: 10px; overflow-y: auto; height: 100%;">
        <h1 style="font-size: 5rem; margin-bottom: 0px;" id="final-percent">0%</h1>
        <p style="font-size: 2rem; margin-bottom: 10px;">> DIAGNOSTIC COMPLETE</p>
        <button class="nav-btn" style="position:relative; margin-top:30px;" onclick="AudioEngine.playMenuHover(); location.reload()">>> REBOOT_SYSTEM</button>
    </div>

    <div id="fail-ui">
        <h1 class="fail-text">SYSTEM_CORRUPTED</h1>
        <p style="font-size: 1.5rem; color: #ccffff;">> ALL_IS_LOST</p>
        <button class="nav-btn fail-restart-btn" onclick="AudioEngine.playMenuHover(); location.reload()">>> EMERGENCY RESTART</button>
    </div>
</div>

<script>
    // --- AUDIO ENGINE ---
    const AudioEngine = {
        ctx: null, masterGain: null, delayNode: null, isPlaying: false, isMuted: false, 
        init: function() {
            try {
                const AC = window.AudioContext || window.webkitAudioContext;
                this.ctx = new AC();
                this.masterGain = this.ctx.createGain();
                this.masterGain.gain.value = 0.3;
                this.masterGain.connect(this.ctx.destination);
                this.delayNode = this.ctx.createDelay(); this.delayNode.delayTime.value = 0.35; 
                const feedback = this.ctx.createGain(); feedback.gain.value = 0.4;
                this.delayNode.connect(feedback); feedback.connect(this.delayNode); this.delayNode.connect(this.masterGain);
                if (this.ctx.state === 'suspended') this.ctx.resume();
                this.startMusic();
            } catch(e) {}
        },
        startMusic: function() { if(this.isPlaying) return; this.isPlaying = true; this.musicLoop(); },
        musicLoop: function() {
            if (!this.isPlaying) return;
            const now = this.ctx.currentTime;
            const drone = this.ctx.createOscillator(); const droneGain = this.ctx.createGain();
            drone.type = 'sine'; drone.frequency.value = 55; 
            droneGain.gain.setValueAtTime(0.05, now); droneGain.gain.linearRampToValueAtTime(0, now + 6);
            drone.connect(droneGain); droneGain.connect(this.masterGain); drone.start(now); drone.stop(now + 6);
            
            const osc = this.ctx.createOscillator(); const g = this.ctx.createGain();
            osc.type = 'triangle'; osc.frequency.value = [43.65, 55, 65.41][Math.floor(Math.random()*3)];
            g.gain.setValueAtTime(0, now); g.gain.linearRampToValueAtTime(0.1, now + 2); g.gain.linearRampToValueAtTime(0, now + 7); 
            osc.connect(g); g.connect(this.masterGain); g.connect(this.delayNode); osc.start(now); osc.stop(now + 7);
            setTimeout(() => this.musicLoop(), 4500); 
        },
        playSFX: function(type) {
            if (!this.ctx || this.isMuted) return;
            const t = this.ctx.currentTime;
            const osc = this.ctx.createOscillator(); const g = this.ctx.createGain();
            osc.connect(g); g.connect(this.masterGain);
            if (type === 'type') { osc.type = 'square'; osc.frequency.setValueAtTime(2000+Math.random()*1000, t); g.gain.setValueAtTime(0.01, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.03); osc.start(t); osc.stop(t+0.03); }
            else if (type === 'click') { osc.type = 'square'; osc.frequency.setValueAtTime(800, t); g.gain.setValueAtTime(0.01, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.05); osc.start(t); osc.stop(t+0.05); } 
            else if (type === 'success') { osc.type = 'sine'; osc.frequency.setValueAtTime(600, t); osc.frequency.exponentialRampToValueAtTime(1200, t+0.1); g.gain.setValueAtTime(0.1, t); g.gain.linearRampToValueAtTime(0, t+0.2); g.connect(this.delayNode); osc.start(t); osc.stop(t+0.2); } 
            else if (type === 'error') { osc.type = 'triangle'; osc.frequency.setValueAtTime(150+Math.random()*50, t); osc.frequency.linearRampToValueAtTime(50, t+0.4); g.gain.setValueAtTime(0.2, t); g.gain.linearRampToValueAtTime(0, t+0.4); osc.start(t); osc.stop(t+0.4); } 
        },
        playMenuHover: function() {
            if (!this.ctx || this.isMuted) return;
            const t = this.ctx.currentTime;
            const osc = this.ctx.createOscillator(); const g = this.ctx.createGain();
            osc.type = 'square'; osc.frequency.setValueAtTime(600 + Math.random() * 800, t);
            g.gain.setValueAtTime(0.02, t); g.gain.exponentialRampToValueAtTime(0.001, t + 0.15); 
            osc.connect(g); g.connect(this.masterGain); osc.start(t); osc.stop(t + 0.15);
        },
        toggleMute: function() {
            this.isMuted = !this.isMuted;
            if(this.masterGain) this.masterGain.gain.setTargetAtTime(this.isMuted ? 0 : 0.3, this.ctx.currentTime, 0.1);
            document.getElementById('sound-toggle').innerText = this.isMuted ? "[AUDIO:OFF]" : "[AUDIO:ON]";
        }
    };

    // --- GAME LOGIC ---
    let matchState = { selected: null, pairsFound: 0 };
    let qQueue = []; let currentScore = 0; window.integrity = 100;
    let explainTimer = null; let questionsCorrect = 0; let questionsAttempted = 0; let isDead = false;
    let hudInterval = null; let sessionTime = 5400; let tempLevel = 0; const TEMP_MAX = 60;
    
    // DATA
    const MASTER_DATABASE = [
        {
            tags: ["CORE1", "Hardware"],
            question: "Which connector is described as having a 20+4 pin configuration to ensure backward compatibility?",
            options: ["CPU Power", "PCIe Power", "Main Motherboard Power", "Molex Power"],
            answer: 2,
            explanation: "The Main Motherboard Power connector often comes in a 20+4 pin configuration, allowing it to work with older 20-pin motherboards or modern 24-pin motherboards."
        },
        {
            tags: ["CORE1", "Hardware"],
            question: "A user asks why their modular PSU is better for their gaming PC than a non-modular one. What is the technical advantage regarding the case environment?",
            options: ["It provides more wattage", "It reduces electrical interference", "It improves airflow by removing unused cables", "It has a backup battery built-in"],
            answer: 2,
            explanation: "The primary advantage of a modular PSU is the ability to remove unused cables, which reduces cable clutter and significantly improves airflow inside the case."
        },
        {
            tags: ["CORE1", "Hardware"],
            question: "Which voltage rail is primarily used for logic circuits and some peripherals?",
            options: ["+12V", "+5V", "+3.3V", "-12V"],
            answer: 1,
            explanation: "The +5V rail is typically used to power logic circuits and some peripherals."
        },
        {
            tags: ["CORE1", "Hardware"],
            question: "You are installing a PSU in a case where the power supply mount is at the bottom. The case has a filtered vent on the bottom floor. How should you orient the PSU?",
            options: ["Fan facing up into the case", "Fan facing down towards the vent", "Fan facing the side panel", "Fan facing the front intake"],
            answer: 1,
            explanation: "The PSU should be installed with the fan facing down. This allows it to pull cool air from outside the bottom of the case and exhaust it out the back, isolating it from the system heat."
        },
        {
            tags: ["CORE1", "Hardware"],
            question: "Which type of liquid cooling system connects multiple components (CPU, GPU, VRMs) into a single circuit and requires manual cutting of tubing?",
            options: ["Closed Loop", "Open Loop (Custom Loop)", "AIO", "Passive Loop"],
            answer: 1,
            explanation: "An Open Loop (or Custom Loop) system connects multiple components and requires complex installation including cutting tubing, filling liquid, and leak testing."
        },
        {
            tags: ["CORE1", "Hardware"],
            question: "Why are PSU connectors 'Keyed' with specific shapes for the plastic housing?",
            options: ["To make them look aesthetically pleasing", "To prevent reversing the polarity and damaging components", "To increase the data transfer speed", "To lock them permanently into place"],
            answer: 1,
            explanation: "Connectors are keyed (shaped) so they only fit in one direction. This prevents the user from reversing the polarity (Positive/Negative), which would fry the component."
        },
        {
            tags: ["CORE1", "Hardware"],
            question: "Ideally, how should airflow be managed using case fans?",
            options: ["Front/Bottom for Exhaust; Rear/Top for Intake", "Front/Bottom for Intake; Rear/Top for Exhaust", "All fans should be Intake", "All fans should be Exhaust"],
            answer: 1,
            explanation: "Generally, Front and Bottom fans should be set to Intake (pull cool air in), while Rear and Top fans should be set to Exhaust (push hot air out)."
        },
        {
            tags: ["CORE1", "Troubleshooting"],
            type: "terminal",
            question: "A technician has just installed a new CPU cooler and wants to reboot the system immediately to verify temperatures in the BIOS. Enter the command to restart the computer.",
            validCommands: ["shutdown /r", "shutdown -r"],
            hint: "Use the shutdown command with the restart switch.",
            explanation: "The 'shutdown /r' command restarts the computer, allowing the technician to enter the BIOS and check thermal performance."
        },
        {
            tags: ["CORE1", "Troubleshooting"],
            type: "terminal",
            question: "A specific process is unresponsive and causing the CPU to overheat. Enter the command to force stop a process by its name or ID.",
            validCommands: ["taskkill", "taskkill /?"],
            hint: "The command implies 'killing' a task.",
            explanation: "The 'taskkill' command is used to terminate tasks or processes that are stuck or consuming excessive resources."
        },
        {
            tags: ["CORE1", "Troubleshooting"],
            type: "terminal",
            question: "You need to check if the hard drive motors are spinning up and being recognized by the file system logic. Enter the command to manage disk partitions.",
            validCommands: ["diskpart"],
            hint: "This command opens the disk partition utility.",
            explanation: "'diskpart' is a command-line utility used to manage disk partitions and volumes."
        },
        {
            tags: ["CORE1", "Troubleshooting"],
            type: "terminal",
            question: "To ensure the new power settings are applied, you want to update the group policy on the local machine immediately. Enter the command to force a group policy update.",
            validCommands: ["gpupdate /force", "gpupdate"],
            hint: "Update the Group Policy.",
            explanation: "The 'gpupdate /force' command updates local and Active Directory Group Policy settings immediately."
        },
        {
            tags: ["CORE1", "Hardware"],
            type: "match",
            question: "Match the PSU Rail Voltage to its Primary Application.",
            pairs: [
                { left: "+12V", right: "High-power motors and CPU/GPU" },
                { left: "+5V", right: "Logic circuits" },
                { left: "+3.3V", right: "M.2 slots and RAM" },
                { left: "-12V", right: "Legacy serial ports/LAN" }
            ],
            explanation: "The 12V rail powers motors/CPU, 5V powers logic, 3.3V powers RAM/M.2, and -12V is for legacy circuits."
        }
    ];
    
    function fetchQuestions(tags) { return MASTER_DATABASE.filter(q => tags.every(t => q.tags.includes(t))); }

    // --- VISUALS ---
    function spawnScanline() {
        if(isDead) return;
        const line = document.createElement('div'); line.className = 'scan-line';
        line.style.height = (Math.random() * 3 + 1) + 'px';
        line.style.animation = `scan-drop ${Math.random() * 5 + 4}s linear forwards`;
        document.getElementById('scan-container').appendChild(line);
        setTimeout(() => line.remove(), 10000);
        setTimeout(spawnScanline, Math.random() * 8000 + 6000); 
    }
    spawnScanline();

    function triggerRandomGlitch() {
        if(isDead) return;
        const chaos = 1 - (integrity / 100);
        if(Math.random() < 0.05 + (chaos * 0.5)) {
            const targets = document.querySelectorAll('.btn, .question-box, h1, .match-item');
            if(targets.length > 0) {
                const target = targets[Math.floor(Math.random()*targets.length)];
                target.classList.add('random-glitch-active');
                setTimeout(() => target.classList.remove('random-glitch-active'), 150);
            }
        }
        setTimeout(triggerRandomGlitch, 200 + (integrity * 5));
    }
    
    function spawnHexDump() {
        if(isDead) return;
        const chars = "0123456789ABCDEF"; let str = "";
        for(let r=0; r<6; r++) { str += "0x"; for(let i=0; i<4; i++) str += chars[Math.floor(Math.random()*16)]; str += "\n"; }
        const el = document.createElement('div'); el.className = "hex-dump";
        el.style[Math.random() > 0.5 ? 'left' : 'right'] = Math.random() * 15 + "%"; el.style.top = Math.random() * 90 + "%";
        document.body.appendChild(el);
        setTimeout(()=>el.remove(), 8000);
        setTimeout(spawnHexDump, Math.random() * 3000 + 2000);
    }
    
    const canvas = document.getElementById('matrix-canvas'); const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    const fontSize = 14; const columns = Math.floor(canvas.width / fontSize); const drops = Array(columns).fill(1); 
    const baseChars = "01010x<>!@#{}[]ZEUS"; 
    function drawRain() {
        if(Math.random() > 0.5) { requestAnimationFrame(drawRain); return; } 
        ctx.fillStyle = 'rgba(0, 0, 0, 0.05)'; ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--term-color'); 
        ctx.font = fontSize + 'px monospace';
        for(let i=0; i<drops.length; i++) {
            const char = baseChars[Math.floor(Math.random()*baseChars.length)];
            ctx.fillText(char, i*fontSize, drops[i]*fontSize);
            if(drops[i]*fontSize > canvas.height && Math.random() > 0.99) drops[i] = 0; drops[i]++;
        }
        requestAnimationFrame(drawRain);
    }
    drawRain();

    function scrambleText(element, finalString, duration=500) {
        const alphabet = "0101010101XYZ<>";
        let start = Date.now();
        let charCount = 0;
        function update() {
            let prog = (Date.now() - start) / duration;
            if(prog >= 1) { element.innerText = finalString; return; }
            let txt = "";
            for(let i=0; i<finalString.length; i++) {
                if(i < finalString.length * prog) txt += finalString[i];
                else txt += alphabet[Math.floor(Math.random()*alphabet.length)];
            }
            element.innerText = txt;
            charCount++;
            if(charCount % 2 === 0) AudioEngine.playSFX('type');
            requestAnimationFrame(update);
        }
        update();
    }

    function typeExplain(element, text) {
        if (explainTimer) { clearTimeout(explainTimer); explainTimer = null; }
        element.style.display = 'block'; element.innerHTML = ""; let i = 0;
        function type() {
            if (i < text.length) { 
                element.innerHTML += text.charAt(i); i++; 
                if(i % 2 === 0) AudioEngine.playSFX('type');
                explainTimer = setTimeout(type, 20); 
            }
        }
        type();
    }

    function startHUD() {
        if (hudInterval) clearInterval(hudInterval);
        hudInterval = setInterval(() => {
            if(isDead) return;
            if (sessionTime > 0) sessionTime--;
            let mins = Math.floor(sessionTime / 60); let secs = sessionTime % 60;
            document.getElementById('session-timer').innerText = `${mins}:${secs.toString().padStart(2, '0')}`;

            if (document.getElementById('next-btn').classList.contains('hidden')) {
                if (tempLevel < TEMP_MAX) tempLevel++;
                updateTempVisuals();
            }
        }, 1000);
    }

    function updateTempVisuals() {
        const bar = document.getElementById('temp-bar');
        const label = document.getElementById('temp-label');
        const pct = tempLevel / TEMP_MAX;
        bar.style.width = `${pct * 100}%`;

        if (tempLevel >= 50) {
            label.innerText = "!! OVERHEAT !!"; label.style.color = "#ff0000"; label.classList.add('label-crit'); bar.classList.add('temp-pulse-active'); bar.style.background = "red";
        } else if (tempLevel >= 40) {
            label.innerText = ">> DANGER <<"; label.style.color = "#ff4400"; label.classList.add('label-crit'); bar.classList.add('temp-pulse-active'); bar.style.background = "orange";
        } else if (tempLevel >= 30) {
            label.innerText = ">> WARM <<"; label.style.color = "#ffaa00"; bar.classList.remove('temp-pulse-active'); bar.style.background = "yellow";
        } else {
            label.innerText = "TEMP"; label.style.color = "#ffffff"; label.classList.remove('label-crit'); bar.classList.remove('temp-pulse-active'); bar.style.background = "#0affba";
        }
    }

    // --- SYSTEM LOGIC ---
    function bootSystem() {
        document.getElementById('start-overlay').style.display = 'none';
        AudioEngine.init(); 
        const term = document.getElementById('term-win');
        term.style.display = 'flex'; term.classList.add('power-on');
        const btns = document.querySelectorAll('.btn');
        btns.forEach((b, i) => { setTimeout(() => { b.classList.add('visible'); }, 500 + (i * 150)); });
        spawnHexDump(); triggerRandomGlitch();
    }

    function goToSubMenu(type, titleName) {
        const header = document.getElementById('main-header');
        header.innerHTML = `SYSTEM <span style="font-size:0.6em; color:#fff;">${titleName || 'ROOT'}</span>`;
        header.classList.add('logo-glitch'); setTimeout(()=>header.classList.remove('logo-glitch'), 300);

        document.getElementById('root-menu').classList.add('hidden');
        document.getElementById(type + '-menu').classList.remove('hidden');
        const target = document.getElementById(type + '-menu');
        const btns = target.querySelectorAll('.btn');
        btns.forEach((b, i) => { b.classList.remove('visible'); setTimeout(() => { b.classList.add('visible'); }, 100 + (i * 100)); });
    }

    function goToRoot() {
        document.getElementById('main-header').innerHTML = 'SYSTEM <span style="font-size:0.6em; color:#fff;">ROOT</span>';
        document.querySelectorAll('[id$="-menu"]').forEach(m => m.classList.add('hidden'));
        document.getElementById('root-menu').classList.remove('hidden');
    }
    
    function transitionToQuiz(certTag, moduleTag) {
        qQueue = fetchQuestions([certTag, moduleTag]);
        if(qQueue.length === 0) { alert("NO DATA"); return; }
        for (let i = qQueue.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [qQueue[i], qQueue[j]] = [qQueue[j], qQueue[i]]; }
        startQuiz();
    }
    
    function startExam(certTag) {
        qQueue = fetchQuestions([certTag]).slice(0, 90);
        startQuiz();
    }

    function startQuiz() {
        document.querySelectorAll('[id$="-menu"], #root-menu').forEach(m => m.classList.add('hidden'));
        document.getElementById('quiz-ui').classList.remove('hidden');
        resetGame(); startHUD(); loadSeq();
    }
    
    function resetGame() {
        currentScore = 0; integrity = 100; tempLevel = 0; isDead = false; questionsCorrect = 0; questionsAttempted = 0;
        document.getElementById('fail-ui').classList.remove('fail-visible'); 
        updateSystemState();
    }

    function updateSystemState() {
        if (integrity > 100) integrity = 100; if (integrity < 0) integrity = 0;
        
        const bar = document.getElementById('integrity-bar');
        bar.style.width = `${integrity}%`;
        document.getElementById('score-ui').innerText = `PTS: ${currentScore}`;

        const root = document.documentElement; 
        
        // DYNAMIC COLOR SHIFT
        let hue, sat, light;
        if(integrity > 50) { hue = 140 + ((integrity - 50) * 0.4); } 
        else { hue = integrity * 1.2; }
        const newColor = `hsl(${hue}, 100%, 50%)`;
        const glowColor = `hsla(${hue}, 100%, 50%, 0.6)`;
        
        root.style.setProperty('--term-color', newColor);
        root.style.setProperty('--glow-color', glowColor);
        
        // EDGE PULSE LOGIC (Health-Tied)
        // 100% health = 0 opacity. 0% health = 0.8 opacity.
        const panicLevel = (100 - integrity) / 100;
        root.style.setProperty('--edge-opacity', panicLevel * 0.8);
        
        // PULSE SPEED INCREASE (Lower health = Faster pulse)
        // 2s at full health, 0.5s at low health
        const speed = 2 - (panicLevel * 1.5);
        root.style.setProperty('--pulse-speed', `${speed}s`);

        if(integrity <= 0 && !isDead) triggerFailure();
    }

    function triggerFailure() { 
        isDead = true;
        document.getElementById('fail-ui').classList.add('fail-visible'); 
        AudioEngine.playSFX('error'); 
    }

    function loadSeq() {
        if (integrity <= 0 || qQueue.length === 0) { if(qQueue.length === 0) finish(); return; }
        
        tempLevel = 0; updateTempVisuals();
        const q = qQueue.pop(); window.currentQ = q;
        document.getElementById('packet-counter').innerText = qQueue.length;
        scrambleText(document.getElementById('q-text'), q.question, 400);
        
        document.getElementById('explanation-box').style.display = 'none';
        document.getElementById('next-btn').classList.add('hidden');
        document.getElementById('opts-list').innerHTML = '';
        document.getElementById('pbq-area').style.display = 'none';
        document.getElementById('pbq-submit-btn').style.display = 'none';

        if (q.type === 'terminal' || q.type === 'match') renderPBQ(q); else renderMCQ(q);
    }

    function renderMCQ(q) {
        const optsList = document.getElementById('opts-list');
        q.options.forEach((o, i) => {
            const b = document.createElement('button'); b.className = 'option-btn'; b.innerText = `> ${o}`;
            b.style.setProperty('--i', i); // For staggered animation
            b.onclick = () => processResult(i === q.answer, b);
            optsList.appendChild(b);
        });
    }

    function renderPBQ(q) {
        const area = document.getElementById('pbq-area'); area.innerHTML = ''; area.style.display = 'flex';
        document.getElementById('pbq-submit-btn').style.display = 'block';

        if (q.type === 'terminal') {
            area.innerHTML = `<div class="cmd-input-line"><span>C:\\></span><input type="text" id="cmd-input"></div>`;
        } else if (q.type === 'match') {
            matchState = { selected: null, pairsFound: 0 };
            area.innerHTML = `<div class="match-container"><div class="match-col" id="col-left"></div><div class="match-col" id="col-right"></div></div>`;
            q.pairs.forEach((p, i) => {
                const l = document.createElement('div'); l.className='match-item'; l.innerText=p.left; l.dataset.id=i; l.dataset.side='l'; l.onclick=e=>handleMatch(e.target);
                document.getElementById('col-left').appendChild(l);
                const r = document.createElement('div'); r.className='match-item'; r.innerText=p.right; r.dataset.id=i; r.dataset.side='r'; r.onclick=e=>handleMatch(e.target);
                document.getElementById('col-right').appendChild(r);
            });
            const rCol = document.getElementById('col-right');
            for (let i = rCol.children.length; i >= 0; i--) rCol.appendChild(rCol.children[Math.random() * i | 0]);
        }
    }

    function handleMatch(el) {
        if(el.classList.contains('matched')) return;
        if(matchState.selected === el) { el.classList.remove('selected'); matchState.selected=null; return; }
        if(!matchState.selected) { matchState.selected = el; el.classList.add('selected'); }
        else {
            const prev = matchState.selected;
            if(prev.dataset.side === el.dataset.side) { prev.classList.remove('selected'); el.classList.add('selected'); matchState.selected = el; return; }
            if(prev.dataset.id === el.dataset.id) {
                prev.classList.remove('selected'); el.classList.remove('selected');
                prev.classList.add('matched'); el.classList.add('matched');
                AudioEngine.playSFX('click'); matchState.pairsFound++; matchState.selected = null;
            } else {
                prev.classList.remove('selected'); el.classList.add('wrong'); setTimeout(()=>el.classList.remove('wrong'), 400);
                AudioEngine.playSFX('error'); matchState.selected = null; integrity-=1; updateSystemState(); 
                
                const wrap = document.getElementById('integrity-wrap');
                wrap.classList.remove('dmg-shock'); void wrap.offsetWidth; wrap.classList.add('dmg-shock');

                const errs = ["SEG_FAULT", "NaN", "0x00DEAD", "NULL_REF", "BIT_FLIP"];
                showFloatText(errs[Math.floor(Math.random()*errs.length)], el, 'red');
            }
        }
    }

    function submitPBQ() {
        const q = window.currentQ; let correct = false;
        if(q.type === 'terminal') { if(q.validCommands.includes(document.getElementById('cmd-input').value.trim().toLowerCase())) correct = true; }
        else if (q.type === 'match') { if(matchState.pairsFound === q.pairs.length) correct = true; }
        processResult(correct, document.getElementById('pbq-submit-btn'));
    }

    function processResult(isCorrect, btn) {
        questionsAttempted++;
        document.querySelectorAll('.option-btn').forEach(b => b.style.pointerEvents = 'none');
        document.getElementById('pbq-submit-btn').style.display = 'none';
        
        if (isCorrect) {
            questionsCorrect++;
            btn.classList.add('correct'); currentScore++; integrity += 5;
            AudioEngine.playSFX('success'); showFloatText("ACCEPTED", btn, '#0f0');
        } else {
            btn.classList.add('wrong'); integrity -= 15;
            AudioEngine.playSFX('error'); showFloatText("CORRUPT", btn, '#f00');
            
            const wrap = document.getElementById('integrity-wrap');
            wrap.classList.remove('dmg-shock'); 
            void wrap.offsetWidth; 
            wrap.classList.add('dmg-shock');
        }
        
        typeExplain(document.getElementById('explanation-box'), ">> " + window.currentQ.explanation);
        updateSystemState();
        if (integrity > 0) document.getElementById('next-btn').classList.remove('hidden');
    }

    function nextSeq() { AudioEngine.playSFX('click'); loadSeq(); }
    
    function showFloatText(text, element, color) {
        const floatEl = document.createElement('div'); floatEl.className = 'float-text'; floatEl.innerText = text;
        floatEl.style.color = color; floatEl.style.textShadow = `0 0 10px ${color}`;
        document.body.appendChild(floatEl); 
        const rect = element.getBoundingClientRect();
        floatEl.style.left = (rect.left + rect.width/2 - 20) + 'px'; floatEl.style.top = rect.top + 'px';
        setTimeout(() => floatEl.remove(), 2000);
    }
    
    function showCrypto() {
        AudioEngine.playSFX('success');
        const walletAddress = "kaspa:qqy08j0lcaunrga9pdq29sputscc8v5hjjyjlge93qye9aexejhxv43sq7tyq"; 
        
        const popup = document.createElement('div');
        popup.style.cssText = "position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); width:80%; max-width:500px; background:rgba(0,10,10,0.95); border:2px solid #70c7ba; padding:20px; z-index:9000; text-align:center; box-shadow:0 0 50px rgba(112,199,186,0.3);";
        
        popup.innerHTML = `
            <h2 style="color:#70c7ba; margin:0 0 10px 0;">>> SECURE CHANNEL <<</h2>
            <div style="background:#000; padding:10px; color:#70c7ba; margin-bottom:15px; border:1px dashed #555; word-break:break-all;">${walletAddress}</div>
            <button id="copy-btn" class="sys-btn" style="margin-right:10px; color:#70c7ba; border-color:#70c7ba;">[ COPY ]</button>
            <button id="close-crypto" class="sys-btn" style="color:#ff4444; border-color:#ff4444;">[ CLOSE ]</button>
        `;
        document.body.appendChild(popup);

        document.getElementById('copy-btn').onclick = () => {
            navigator.clipboard.writeText(walletAddress);
            AudioEngine.playSFX('success');
            document.getElementById('copy-btn').innerText = "[ COPIED ]";
        };
        document.getElementById('close-crypto').onclick = () => {
             AudioEngine.playSFX('click');
             popup.remove();
        };
    }

    function finish() {
        document.getElementById('quiz-ui').classList.add('hidden');
        document.getElementById('results-ui').classList.remove('hidden');
        
        let pct = 0;
        if(questionsAttempted > 0) pct = Math.floor((questionsCorrect/questionsAttempted)*100);
        
        let i = 0;
        const interval = setInterval(() => {
            document.getElementById('final-percent').innerText = `${i}%`;
            if (i >= pct) clearInterval(interval); i++;
        }, 20);
    }
    
    function shutdownSystem() { location.reload(); }

</script>
</body>
</html>
